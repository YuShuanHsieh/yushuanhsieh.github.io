<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Understanding Router in Angular 6 — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Understanding Router in Angular 6</h1><div class=post-meta><time datetime=2018-05-24>May 24, 2018</time>
<span class=separator>·</span>
<span class=reading-time>6 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/web/>Web</a></div></header><div class=post-content><h2 id=前言>前言：</h2><p>這陣子在看 Reactive Extension (Rx) 和 Angular ，而 Angular 中常使用的 Router 內就有些 Observable Type 的 instance，因此就打算從這邊深入了解一下 Angular Router 的流程和 Observable 應用方式。</p><h2 id=router-navigation>Router Navigation</h2><h3 id=overview>Overview</h3><p>![router.png]({{ site.url }}/assets/images/router.png)</p><p>首先，先來說一下大致流程，當使用者點擊設有 <code>routerLink</code> attribute 超連結時（或是在 component 裡面 trigger router navigation），設置的連結會先經過分析步驟，然後透過 Router 找出對應的 Component，再將此 Component 呈現在設置好 <code>&lt;router-outlet>&lt;/router-outlet></code> 的地方。</p><h3 id=建立-router-service>建立 Router Service</h3><p>網上有很多案例會教導如何設置 Component 的 Router，如下：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>import</span> <span style=color:#1f2328>{</span> <span style=color:#1f2328>RouterModule</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>Routes</span> <span style=color:#1f2328>}</span> <span style=color:#1f2328>from</span> <span style=color:#0a3069>&#39;@angular/router&#39;</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>routes</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>Routes</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>[{</span><span style=color:#1f2328>path</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;content/:id&#39;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>component</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>ArticleComponent</span><span style=color:#1f2328>}];</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>@</span><span style=color:#1f2328>NgModule</span><span style=color:#1f2328>({</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>imports</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>[</span><span style=color:#1f2328>RouterModule</span><span style=color:#1f2328>.</span><span style=color:#1f2328>forRoot</span><span style=color:#1f2328>(</span><span style=color:#1f2328>routes</span><span style=color:#1f2328>)],</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>declarations</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>[</span><span style=color:#1f2328>ArticleComponent</span><span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而 <code>RouterModule.forRoot(routes)</code> 實際上會建立一個 <code>Router</code> 的 Singleton Service，裡面有 instance <code>Router.RouterState</code> 來管理目前的 Route 狀態，以及一些 methods 來讓使用者透過 Router 來進行 navigation。
<a href=https://angular.io/api/router/Router>Router class API</a></p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>class</span> <span style=color:#1f2328>Router</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>// 省略其他 methods or instance
</span></span></span><span style=display:flex><span>  <span style=color:#1f2328>get</span> <span style=color:#1f2328>routerState</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>RouterState</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>navigateByUrl</span><span style=color:#1f2328>(</span><span style=color:#1f2328>url</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>string</span> <span style=color:#0550ae>|</span> <span style=color:#1f2328>UrlTree</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>extras</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>NavigationExtras</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span> <span style=color:#1f2328>skipLocationChange</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>false</span> <span style=color:#1f2328>})</span><span style=color:#0550ae>:</span> <span style=color:#6639ba>Promise</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>boolean</span><span style=color:#0550ae>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>navigate</span><span style=color:#1f2328>(</span><span style=color:#1f2328>commands</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>any</span><span style=color:#1f2328>[],</span> <span style=color:#1f2328>extras</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>NavigationExtras</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span> <span style=color:#1f2328>skipLocationChange</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>false</span> <span style=color:#1f2328>})</span><span style=color:#0550ae>:</span> <span style=color:#6639ba>Promise</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>boolean</span><span style=color:#0550ae>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=routerstate-樹狀結構與-activatedroute-結點>RouterState 樹狀結構與 ActivatedRoute 結點</h3><h4 id=routerstate>RouterState</h4><p><code>RouterState</code> 是一個由 ActivedRoute 所組成的樹狀結構，以及 <code>RouterStateSnapshot</code> 存放當前的 Route 狀態。所以如果想要查看當前狀態，可以直接透過此 Service 進行查詢。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>constructor<span style=color:#1f2328>(</span>private router<span style=color:#1f2328>:</span> Router<span style=color:#1f2328>){}</span>
</span></span><span style=display:flex><span>this<span style=color:#0550ae>.</span>router<span style=color:#0550ae>.</span>routerState<span style=color:#0550ae>.</span>snapshot<span style=color:#0550ae>.</span>url<span style=color:#1f2328>;</span> <span style=color:#0550ae>/**</span> <span style=color:#f6f8fa;background-color:#82071e>如果當前路徑在</span><span style=color:#0550ae>/</span>Article<span style=color:#0550ae>/</span><span style=color:#0550ae>1</span><span style=color:#f6f8fa;background-color:#82071e>，就會印出</span> <span style=color:#0550ae>/</span>Article<span style=color:#0550ae>/</span><span style=color:#0550ae>1</span> <span style=color:#0550ae>*/</span>
</span></span></code></pre></td></tr></table></div></div><p><a href=https://angular.io/api/router/RouterStateSnapshot>RouterStateSnapshot Interface</a>
而當使用者在進行 navigation 時，就是透過 <code>RouterState</code> 內的樹狀結構來找到對應的 Component。</p><h4 id=activatedroute>ActivatedRoute</h4><p>上面提到 <code>RouterState</code> 是個樹狀結構，而 <code>ActivatedRoute</code> 就是其中每個 node。 <code>ActivatedRoute</code> 除了有 <code>routeConfig</code> 配置要顯示 Component 和 matcher (負責驗證當前路徑是否匹配)，更重要的是還帶有 <code>params</code> 和 <code>data</code>，讓頁面在切換到指定 Component 時，也能將資料帶往 Component。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>interface</span> <span style=color:#1f2328>ActivatedRoute</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>params</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>Observable</span><span style=color:#0550ae>&lt;</span><span style=color:#1f2328>Params</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>data</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>Observable</span><span style=color:#0550ae>&lt;</span><span style=color:#1f2328>Data</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>get</span> <span style=color:#1f2328>paramMap</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>Observable</span><span style=color:#0550ae>&lt;</span><span style=color:#1f2328>ParamMap</span><span style=color:#0550ae>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>假設配置路徑為</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>routes</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>[{</span><span style=color:#1f2328>path</span> <span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;article/:id&#39;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>component</span> <span style=color:#0550ae>:</span> <span style=color:#1f2328>ArticleComponent</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>data</span> <span style=color:#0550ae>:</span> <span style=color:#1f2328>{</span><span style=color:#1f2328>content</span> <span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;my article&#39;</span><span style=color:#1f2328>}}]</span>
</span></span></code></pre></td></tr></table></div></div><p>當點擊以下路徑</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>a</span> <span style=color:#1f2328>routerLink</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;/article/1&#34;</span><span style=color:#1f2328>&gt;&lt;/</span><span style=color:#0550ae>a</span><span style=color:#1f2328>&gt;</span> 
</span></span></code></pre></td></tr></table></div></div><p>就可以透過以下方式來取得對應資料</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#1f2328>constructor</span><span style=color:#1f2328>(</span><span style=color:#cf222e>private</span> <span style=color:#1f2328>route</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>ActivatedRoute</span><span style=color:#1f2328>){}</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>route</span><span style=color:#1f2328>.</span><span style=color:#1f2328>params</span><span style=color:#1f2328>.</span><span style=color:#1f2328>subscribe</span><span style=color:#1f2328>(</span><span style=color:#1f2328>params</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>params</span><span style=color:#1f2328>)</span> <span style=color:#57606a>// {id: 1}
</span></span></span><span style=display:flex><span><span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>route</span><span style=color:#1f2328>.</span><span style=color:#1f2328>data</span><span style=color:#1f2328>.</span><span style=color:#1f2328>subscribe</span><span style=color:#1f2328>(</span><span style=color:#1f2328>data</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>data</span><span style=color:#1f2328>)</span> <span style=color:#57606a>// {content : &#39;my article&#39;}
</span></span></span></code></pre></td></tr></table></div></div><h4 id=activatedroute-injection>ActivatedRoute Injection</h4><p>要注意的是，一個 ActivatedRoute 對應一個 Component，所以當從 Component Inject ActivatedRoute 時，他會引入關聯到此 Component 的 ActivatedRoute。如果你是想從 Service Inject ActivatedRoute，那要記得<strong>在 Component 註冊此 Service</strong>，假設是在 Module 層註冊 Service，那 Service 就會為 Singleton Service（意指 Application 內的 Component 都共用此 Service，當然如果你使用 Angular 6 的 provideredIn ，就是指 module 底下的 Component），並會 Inject 到 RouterState.root 這個 ActivatedRoute，這樣就不會是我們想要的結果。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>@</span><span style=color:#1f2328>Component</span><span style=color:#1f2328>({</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>selector</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;article&#39;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>templateUrl</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;article.html&#39;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>providers</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>[</span><span style=color:#1f2328>ArticleService</span><span style=color:#1f2328>]</span> <span style=color:#57606a>// 在此宣告 Service，讓 Service 是依賴在此 Component.
</span></span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=subscribe-activatedroute-service>Subscribe ActivatedRoute Service</h3><p>最後，假設我們需要追蹤 ActivatedRoute.params 的變動，根據最新的 params 值做處理，很理所當然地，我們會使用 subscribe，例如：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#1f2328>constructor</span><span style=color:#1f2328>(</span><span style=color:#cf222e>private</span> <span style=color:#1f2328>route</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>ActivatedRoute</span><span style=color:#1f2328>){}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#1f2328>ngOnInit</span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>route</span><span style=color:#1f2328>.</span><span style=color:#1f2328>params</span><span style=color:#1f2328>.</span><span style=color:#1f2328>subscribe</span><span style=color:#1f2328>(</span><span style=color:#1f2328>params</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// deal with params
</span></span></span><span style=display:flex><span>  <span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來，當 route.params 值發生改變時，我們就可以透過 subscribe 來追蹤。思考 observable 的做法，如果能進行 subscribe，那必定有個執行 next(params) 的地方。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>function</span> <span style=color:#1f2328>advanceActivatedRoute</span><span style=color:#1f2328>(</span><span style=color:#1f2328>route</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>ActivatedRoute</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>route</span><span style=color:#1f2328>.</span><span style=color:#1f2328>snapshot</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#0550ae>!</span><span style=color:#1f2328>shallowEqual</span><span style=color:#1f2328>(</span><span style=color:#1f2328>currentSnapshot</span><span style=color:#1f2328>.</span><span style=color:#1f2328>params</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>nextSnapshot</span><span style=color:#1f2328>.</span><span style=color:#1f2328>params</span><span style=color:#1f2328>))</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>(</span><span style=color:#0550ae>&lt;</span><span style=color:#1f2328>any</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>route</span><span style=color:#1f2328>.</span><span style=color:#1f2328>params</span><span style=color:#1f2328>).</span><span style=color:#1f2328>next</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nextSnapshot</span><span style=color:#1f2328>.</span><span style=color:#1f2328>params</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>當在進行 navigate 時，會執行 <code>runNavigate()</code> ，然後依序處理 navigate 的流程，並執行 <code>activateRoutes()</code> 來觸發上面那段 next(params) 通知 observers。</p><p>如此一來，observer 就可以處理最新 params 了！</p><h2 id=reference>Reference</h2><p><a href=http://vsavkin.tumblr.com/post/145672529346/angular-router>http://vsavkin.tumblr.com/post/145672529346/angular-router</a>
<a href=https://leanpub.com/router>https://leanpub.com/router</a>
<a href=https://vsavkin.com/angular-router-understanding-router-state-7b5b95a12eab>https://vsavkin.com/angular-router-understanding-router-state-7b5b95a12eab</a></p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2018-05-16-javascript-optimization-property/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>How Does JavaScript Engine (V8) Optimize JavaScript code - Fast Property Access</span>
</a><a href=https://yushuanhsieh.github.io/posts/2018-05-29-angular-6-ngtemplate/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>Angular - ng-template & ng-container</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>