<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Angular - Reactive Form — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Angular - Reactive Form</h1><div class=post-meta><time datetime=2018-06-14>June 14, 2018</time>
<span class=separator>·</span>
<span class=reading-time>6 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/web/>Web</a></div></header><div class=post-content><h2 id=前言>前言</h2><p>在建立表單的部份，Angular 與 AngularJS 最大的不同就是多了 <code>Reactive Form</code> 的方式。由於 Reactive Form 比起一般 Template-Driven Form 更具彈性且好掌控，所以就來大致介紹一下與 Reactive Form 相關的流程機制。</p><h2 id=formcontrol>FormControl</h2><p><code>FormControl</code> 是 reactive form 中最基本且必要的角色。它是一個<strong>完全獨立的 Instance</strong>，裡面包含了 value / validators / status 等重要 member variables。想像一下，如果我們需要一個輸入暱稱的 input 欄位，而 formControl 的任務就是要儲存使用者所輸入的暱稱，以及操作內部的 Validators 對輸入的暱稱字元進行驗證。</p><h3 id=formcontrol-運作流程>FormControl 運作流程</h3><p>下圖簡單地介紹 FormControl 的內部機制，首先在建立 FormControl Instance 時，我們可以透過 constructor 初始化 value 和設置想要的 validators function。舉例來說，我們提供給使用者修改暱稱的欄位，需要在欄位上先填好使用者原本的暱稱，以及設置好暱稱驗證方式。</p><p>![Angular FormControl]({{ site.url }}/assets/images/angular-formControl.png)</p><p>而當有新的 value 進來時，會透過 setValue() 這個 function 來更新 value 參數。在 setValue() 更新完 value 之後，就會進行值驗證，看看新進來的 value 是否符合規範，，並將 status 狀態更新為 invalid 或是 valid。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>control</span> <span style=color:#0550ae>=</span> <span style=color:#cf222e>new</span> <span style=color:#1f2328>FormControl</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;&#39;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>Validators</span><span style=color:#1f2328>.</span><span style=color:#1f2328>required</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>control</span><span style=color:#1f2328>.</span><span style=color:#1f2328>setValue</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;newValue&#39;</span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>由於有了值的驗證機制，所以開發者除了可以使用 setValue() 來改變 value variable 之外，還可以透過 FormControl 中的 status 來得知值的驗證結果。這在顯示欄位輸入提示上非常有用。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#57606a>// Formcontrol source code
</span></span></span><span style=display:flex><span><span style=color:#1f2328>setValue</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>any</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>options</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>onlySelf</span><span style=color:#0550ae>?:</span> <span style=color:#cf222e>boolean</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>emitEvent</span><span style=color:#0550ae>?:</span> <span style=color:#cf222e>boolean</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>emitModelToViewChange</span><span style=color:#0550ae>?:</span> <span style=color:#cf222e>boolean</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>emitViewToModelChange</span><span style=color:#0550ae>?:</span> <span style=color:#cf222e>boolean</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>{})</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// update value
</span></span></span><span style=display:flex><span>    <span style=color:#1f2328>(</span><span style=color:#cf222e>this</span> <span style=color:#1f2328>as</span><span style=color:#1f2328>{</span><span style=color:#1f2328>value</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>any</span><span style=color:#1f2328>}).</span><span style=color:#1f2328>value</span> <span style=color:#0550ae>=</span> <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>_pendingValue</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>value</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#57606a>// 中間省略
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// update status function
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>updateValueAndValidity</span><span style=color:#1f2328>(</span><span style=color:#1f2328>options</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=formcontrol-directive>formControl Directive</h2><p>上面有提到， FormControl 本身是一個獨立物件，那該如何讓 FormControl 與 DOM 產生連結? <code>formControl Directive</code> 所扮演的角色就是 <strong>FormControl Instance 和 DOM 之間的橋樑</strong>，讓使用者所輸入的值可以被更新在 FormControl 的 value 參數上，或是當 FormControl 的 value 改變時，新的值可以被寫上 DOM element 。</p><p>我們可以在官網看到以下例子:</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>@Component</span><span style=color:#1f2328>({</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>///...
</span></span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> <span style=color:#cf222e>class</span> <span style=color:#1f2328>ExampleComponent</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>control</span> <span style=color:#0550ae>=</span> <span style=color:#cf222e>new</span> <span style=color:#1f2328>FormControl</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;&#39;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>Validators</span><span style=color:#1f2328>.</span><span style=color:#1f2328>required</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>input</span> <span style=color:#1f2328>type</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;text&#34;</span> <span style=color:#f6f8fa;background-color:#82071e>[</span><span style=color:#1f2328>formControl</span><span style=color:#f6f8fa;background-color:#82071e>]=&#34;</span><span style=color:#1f2328>control</span><span style=color:#f6f8fa;background-color:#82071e>&#34;</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>p</span><span style=color:#1f2328>&gt;</span>{{control.value}}<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>p</span><span style=color:#1f2328>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>這就是將新建立好的 ForControl Instance 傳遞給 formControl Directive 來做操作的意思。</p><p>藉由 formControl Directive 的協助，ForControl Instance 就可以獲得使用者所輸入的值，然後我們就能把值顯示在畫面上。 (如同上方的 <code>{{control.value}}</code> )</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#57606a>// formControl Directive source code
</span></span></span><span style=display:flex><span><span style=color:#cf222e>@Directive</span><span style=color:#1f2328>({</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>selector</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;[formControl]&#39;</span><span style=color:#1f2328>,</span> 
</span></span><span style=display:flex><span>  <span style=color:#1f2328>providers</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>[</span><span style=color:#1f2328>formControlBinding</span><span style=color:#1f2328>],</span> 
</span></span><span style=display:flex><span>  <span style=color:#1f2328>exportAs</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;ngForm&#39;</span><span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> <span style=color:#cf222e>class</span> <span style=color:#1f2328>FormControlDirective</span> <span style=color:#cf222e>extends</span> <span style=color:#1f2328>NgControl</span> <span style=color:#cf222e>implements</span> <span style=color:#1f2328>OnChanges</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>//...
</span></span></span><span style=display:flex><span>  <span style=color:#1f2328>ngOnChanges</span><span style=color:#1f2328>(</span><span style=color:#1f2328>changes</span>: <span style=color:#cf222e>SimpleChanges</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>//...
</span></span></span><span style=display:flex><span>    <span style=color:#1f2328>setUpControl</span><span style=color:#1f2328>(</span><span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>form</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>this</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>//...
</span></span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>// setUpControl
</span></span></span><span style=display:flex><span><span style=color:#cf222e>function</span> <span style=color:#1f2328>setUpControl</span><span style=color:#1f2328>(</span><span style=color:#1f2328>control</span>: <span style=color:#cf222e>FormControl</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>dir</span>: <span style=color:#cf222e>NgControl</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>// write a value to target DOM element. 
</span></span></span><span style=display:flex><span>  <span style=color:#1f2328>dir</span><span style=color:#1f2328>.</span><span style=color:#1f2328>valueAccessor</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>.</span><span style=color:#1f2328>writeValue</span><span style=color:#1f2328>(</span><span style=color:#1f2328>control</span><span style=color:#1f2328>.</span><span style=color:#1f2328>value</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>setUpViewChangePipeline</span><span style=color:#1f2328>(</span><span style=color:#1f2328>control</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>dir</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>setUpModelChangePipeline</span><span style=color:#1f2328>(</span><span style=color:#1f2328>control</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>dir</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>//...
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=valueaccessor>ValueAccessor</h2><p>下方圖顯示 formControl Directive 如何連結 FormControl Instance 和 DOM element。</p><p>![Angular formControl directive]({{ site.url }}/assets/images/angular-directive.png)</p><p>可以看到 DOM element 和 formControl Directive 之間有個 <code>ValueAccessor</code>，它負責與 DOM element 進行互動。當使用者在欄位中輸入字元，觸發 input event 的時候， formControl Directive 就會透過 <code>ValueAccessor</code> 取得使用者輸入的值，然後對 FormControl 的 value 進行更新。</p><p>反之，當 FormControl 的 value 發生變動時， formControl Directive 會藉由 <code>ValueAccessor</code> 的 writeValue() function，將變動的值寫入 DOM element。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#57606a>// DefaultValueAccessor source code
</span></span></span><span style=display:flex><span><span style=color:#1f2328>writeValue</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>any</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>const</span> <span style=color:#1f2328>normalizedValue</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>value</span> <span style=color:#0550ae>==</span> <span style=color:#cf222e>null</span> <span style=color:#0550ae>?</span> <span style=color:#0a3069>&#39;&#39;</span> <span style=color:#0550ae>:</span> <span style=color:#1f2328>value</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>_renderer</span><span style=color:#1f2328>.</span><span style=color:#1f2328>setProperty</span><span style=color:#1f2328>(</span><span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>_elementRef</span><span style=color:#1f2328>.</span><span style=color:#1f2328>nativeElement</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#39;value&#39;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>normalizedValue</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=結論>結論</h2><p>本篇文章介紹 Angular 機制是如何透過建立 <code>FormControl</code>，並且引入 <code>formcontrol Directive</code> 來完成使用者輸入互動和欄位驗證。而這樣的概念也會應用在 <code>formGroup</code> 和 <code>formBuilder</code> 中，往後在寫 Reactive Form 時，就可以更清楚地知道，該如何透過這樣的流程來完成心目中的表單設計。</p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2018-05-29-angular-6-ngtemplate/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>Angular - ng-template & ng-container</span>
</a><a href=https://yushuanhsieh.github.io/posts/2018-06-23-browser-render-engine/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>The Main Flow of Rendering Engines</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>