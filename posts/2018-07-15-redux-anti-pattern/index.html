<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Redux Anti Pattern — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771486583"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Redux Anti Pattern</h1><div class=post-meta><time datetime=2018-07-15>July 15, 2018</time>
<span class=separator>·</span>
<span class=reading-time>7 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/web/>Web</a></div></header><div class=post-content><h2 id=前言>前言</h2><p>這篇文章是基於 <a href=https://blog.mgechev.com/2017/12/07/redux-anti-patterns-race-conditions-state-management-duplication/>Redux Anti-Patterns - Part 1. State Management</a> 所進行的探討，包含在專案內是否有犯類似的錯誤，以及後續該如何改善。文章會結合目前專案所使用的 Redux(ngrx)，並檢視使用 Ngrx 是否能避免這些錯誤發生。</p><h2 id=1-state-duplication>1. State Duplication</h2><h3 id=問題點>問題點</h3><p>錯誤的建立 state 導致 state 內部 property 或是與其他 state 內容重複。文章內以 session 為例子：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>interface</span> <span style=color:#1f2328>Store</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>sessions</span>: <span style=color:#cf222e>Session</span><span style=color:#1f2328>[];</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>/** The currentSession would be a part of sessions*/</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>currentSession</span>: <span style=color:#cf222e>Session</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=解決方式>解決方式</h3><p>如上面的例子，將 <code>currentSession</code> 改成 index 檢索，所以我們實際取用資料時，還是使用 <code>sessions</code> 內的資料，而不是複製一份到 currentSession。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>interface</span> <span style=color:#1f2328>Store</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>sessions</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>{[</span><span style=color:#1f2328>key</span>: <span style=color:#cf222e>number</span><span style=color:#1f2328>]</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>Session</span><span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>currentSession</span>: <span style=color:#cf222e>number</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=檢討>檢討</h3><p>目前專案內在指定特定的物件時，多使用 index 檢索的方式，並沒有上面所發生的 state 重複問題。不過日前在寫 state 時，差點發生類似的錯誤，因為我必須將 state 內的資料分類，而那時候想法是避免在新增刪除時需要重新進行分類（因為State 內的資料結構是採用 Array），所以額外設置一個已分類好的 Entity。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>interface</span> <span style=color:#1f2328>Store</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>books</span>: <span style=color:#cf222e>Array</span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>Book</span><span style=color:#1f2328>&gt;;</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>novel</span>: <span style=color:#cf222e>Array</span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>Book</span><span style=color:#1f2328>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>不過馬上發現這樣會造成與主要資料難同步的問題，再加上考量到專案內會使用特定分類的情況不多，新增刪除的情況也不多，所以就不調整原先的資料架構，加一個 selector 的方式來篩選類別。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>getNovels</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>createSelector</span><span style=color:#1f2328>(</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>getAllBooks</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>books</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>book</span><span style=color:#1f2328>.</span><span style=color:#1f2328>category</span> <span style=color:#0550ae>===</span> <span style=color:#0a3069>&#39;NOVELS&#39;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>假設今天情況改變，專案需要大量的新增刪除行為時，則會調整 state 內的架構，當資料從 DB 取出時，先進行分類，避免後續重複 O(n) 的發生，會是比較好的做法。</p><h2 id=2-incorrect-information-expert>2. Incorrect Information Expert</h2><h3 id=問題點-1>問題點</h3><p>這邊所提到的問題比較是針對 local state，如果把 state 放在錯誤的 component，而且在其子 component 對此 local state 進行操作時，有可能造成 parent component 和 child component state 狀態不一致問題。</p><h3 id=解決方式-1>解決方式</h3><p>使用 reference 的特性，將 state 整個 pass 到 child component，當 child component 操作 state 時，同樣也會影響到 parent component。</p><h3 id=檢討-1>檢討</h3><p>目前專案比較少有類似此 local state 的設計，而這問題相對上也比較好解決。</p><h2 id=3-implicit-state-duplication>3. Implicit State Duplication</h2><h3 id=問題點-2>問題點</h3><p>一個類似 State 重複的問題，文章給了以下例子：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>interface</span> <span style=color:#1f2328>State</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>sessions</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>{[</span><span style=color:#1f2328>key</span>: <span style=color:#cf222e>number</span><span style=color:#1f2328>]</span><span style=color:#0550ae>:</span> <span style=color:#1f2328>Session</span><span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>totalSessions</span>: <span style=color:#cf222e>number</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>currentSession</span>: <span style=color:#cf222e>number</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>其中 totalSessions 為對 sessions Array 所得出的總數，這樣其實也是一種隱性 state 重複。</p><h3 id=解決方式-2>解決方式</h3><p>建議捨棄可以從其他 state property 中得知資訊的 state，例如上方的例子，我們可以在使用時寫成：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#6639ba>Object</span><span style=color:#1f2328>.</span><span style=color:#1f2328>keys</span><span style=color:#1f2328>(</span><span style=color:#1f2328>sessions</span><span style=color:#1f2328>).</span><span style=color:#1f2328>length</span>
</span></span></code></pre></td></tr></table></div></div><p>當然你可能會在在意起效能上的問題，不過使用 pure function 的方式可以達到有效優化。另外，以 ngrx 來說，他使用 observable selector，當 Array 個數發生變化時才會重新運算，所以效能上不會有太大影響。</p><h3 id=檢討-2>檢討</h3><p>目前專案全面改採用 ngrx 搭配 selector，因此這問題目前還沒發生。不過在開發期間確實可以持續注意是否有這類隱性 state 重複問題，藉此讓整個 state 保持一致性。</p><h2 id=4-overwriting-state-updates>4. Overwriting State Updates</h2><h3 id=問題點-3>問題點</h3><p>這個問題起因於 copy 一份 state 內的資料，而在進行 store dispatch 的時候，誤將 copy 的舊資料 pass 到 reducer，導致 state 原本已更新的資料被覆蓋掉。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>setGuide</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>id</span>: <span style=color:#cf222e>string</span><span style=color:#1f2328>)</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>dispatch</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>getStore</span><span style=color:#1f2328>)</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#57606a>/** Problems */</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>const</span> <span style=color:#1f2328>session</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>getStore</span><span style=color:#1f2328>().</span><span style=color:#1f2328>sessions</span><span style=color:#1f2328>[</span><span style=color:#1f2328>id</span><span style=color:#1f2328>];</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>return</span> <span style=color:#1f2328>fetch</span><span style=color:#1f2328>(</span><span style=color:#0a3069>`/session/</span><span style=color:#0a3069>${</span><span style=color:#1f2328>id</span><span style=color:#0a3069>}</span><span style=color:#0a3069>/guide`</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>method</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;put&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>(</span><span style=color:#1f2328>r</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>r</span><span style=color:#1f2328>.</span><span style=color:#1f2328>json</span><span style=color:#1f2328>())</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>(</span><span style=color:#1f2328>guide</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>updateSession</span><span style=color:#1f2328>(</span><span style=color:#1f2328>session</span><span style=color:#1f2328>.</span><span style=color:#cf222e>set</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;guide&#39;</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>new</span> <span style=color:#1f2328>User</span><span style=color:#1f2328>(</span><span style=color:#1f2328>guide</span><span style=color:#1f2328>))));</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=解決方式-3>解決方式</h3><p>當必須在 async 情況下使用 dispatch 時，應該從上一個 action 中獲得最新的資料，再進行 dispatch，如同以下文章中的例子：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>props</span><span style=color:#1f2328>.</span><span style=color:#1f2328>dispatch</span><span style=color:#1f2328>(</span><span style=color:#1f2328>updateSession</span><span style=color:#1f2328>(</span><span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>props</span><span style=color:#1f2328>.</span><span style=color:#1f2328>session</span><span style=color:#1f2328>.</span><span style=color:#cf222e>set</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;title&#39;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#39;Advanced Go&#39;</span><span style=color:#1f2328>)))</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>(</span><span style=color:#1f2328>s</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>props</span><span style=color:#1f2328>.</span><span style=color:#1f2328>dispatch</span><span style=color:#1f2328>(</span><span style=color:#1f2328>setGuide</span><span style=color:#1f2328>(</span><span style=color:#1f2328>s</span><span style=color:#1f2328>)));</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=檢討-3>檢討</h3><p>由於 ngrx 中使用 Effects 來處理 action 執行後再一次進行 dispatch action 的行為，所以這部分的錯誤使用可以較妥善地被避免掉。</p><h2 id=結論>結論</h2><p>可以看出來，維持 state 內資料的一致性，是使用 redux 很重要的議題。就我的角度來看，比較有可能發生錯誤的地方就是在設計 state property 部分，不過目前 ngrx 有提供 <code>Entity</code> 方式讓我們快速組織 state，透過 <code>Entity</code> 幫助下，能夠有效避免 state 設計缺陷。總而言之，以上錯誤都會造成資料不同步問題，所以應該盡量避免嘍～</p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2018-06-24-css-typed-om/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>CSS Typed Object Model</span>
</a><a href=https://yushuanhsieh.github.io/posts/2018-08-05-angular-schematics/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>Angular Schematics</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>