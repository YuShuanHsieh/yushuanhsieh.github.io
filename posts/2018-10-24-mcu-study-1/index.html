<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Microprocessor System Lab. - Nucleo-64 development board — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Microprocessor System Lab. - Nucleo-64 development board</h1><div class=post-meta><time datetime=2018-10-24>October 24, 2018</time>
<span class=separator>·</span>
<span class=reading-time>8 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/other/>Other</a></div></header><div class=post-content><h2 id=前言>前言：</h2><p>在英國的時候，學校大多專注在純軟開發課程上，例如敏捷開發(Agile Development), Web Development, database 等。其中有一堂課令我印象深刻，就是用 logic Unit, MUX 零件自組 16 Instruction Processor，然後自己手動按 Clock 去 fetch / execute instrction，透過這樣的學習，讓我更清楚整個電腦實際運作 Code 的流程。</p><p>自從經過這樣的學習後，對於 Processor 總是有種幻想，雖然回到台灣之後都是在做純軟工作，不過還是很希望可以接觸到更多相關知識（在台灣這些都是資工基本課程，可惜我大學是偏資管，並沒有機會能修到這些課）。幸好，在交大課程找到 <code>微處理機系統實驗</code> 和 <code>嵌入式系統設計概論與實作</code> 這兩堂課程，其中<strong>曹孝櫟教授</strong>教的非常詳細又很有重點，讓我瞬間變他的腦粉啊 &lt;3</p><p>由於學的很開心，也收穫很多，就來記錄一下學習過程。</p><h2 id=課程連結>課程連結</h2><ol><li><a href="http://ocw.nctu.edu.tw/course_detail-v.php?bgid=9&amp;gid=0&amp;nid=572&amp;v5=KmvfobI87bA">Lecture03 Overview of STM32 Board/Development Environment</a></li></ol><h2 id=nucleo-64-development-board>Nucleo-64 development board</h2><p>這堂課是使用 <code>Nucleo</code> 系列板子，Processor 是 <code>ARM Cortex-4M</code>，所以就也買了類似的開發板來玩玩。我是從 <a href=https://www.taiwaniot.com.tw/>物聯網科技</a> 這邊買的，寄件速度快，有可以超商取貨，材料種類又多，很推薦這個網站。</p><p>至於開發板，我是買 <a href=https://www.taiwaniot.com.tw/product/nucleo-f411re-stm32f411re-mbed>NUCLEO-F411RE</a>，記憶體配置和課程所用的開發板略有不同，但是說明手冊差不多，這樣在看課程時比較好做對照。因為是菜鳥初買板子，不知道開發板沒有附上 mini USB 轉接線，所以又匆忙跑去買 QQ。另外就是其他電子零件像是 LED 燈 / 顯示模組 / 杜邦線 / keypad 等也都是課程會用到，需要另外買，不過都很便宜，所以可以一次補齊。</p><h3 id=電子元件項目整理>電子元件項目整理</h3><ul><li>NUCLEO-F411RE 開發板 (相容 Arduino)</li><li>mini USB 轉 USB 線</li><li>杜邦線數條</li><li>MAX7219 7-segment LED 模組</li><li>Arduino 4×4 keypad</li></ul><p>其他像是單個 LED 燈 / Button 等，因為開發板本來就有內建 User Button 和 LED2，所以就不買。</p><h2 id=dev-environment>Dev Environment</h2><h3 id=ide>IDE</h3><h4 id=sw4stm32>SW4STM32</h4><p>課程上是使用 <a href=http://www.openstm32.org/HomePage>SWSTM32</a> IDE 來開發， <code>SW4STM32</code> 是 ST 基於 <code>Eclipse</code> 所發展的 IDE，它結合 openOCD 和 GDB 發揮出強大的 debug 功能。官方手冊也有提供像是 <code>TrueSTUDIO</code> 等教學，所以也可以改用其他 IDE 來開發。</p><p>安裝 SW4STM32 軟體需要一點小技巧，如果你剛從官網下載完檔案，會是一個 <code>install_sw4stm32_macos_64bits-v2.6.run</code> 的 file，此時需透過 bash shell 在 terminal 執行：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>/bin/bash install_sw4stm32_macos_64bits-v2.6.run
</span></span></code></pre></td></tr></table></div></div><p>就會解壓縮，並執行 jar 檔案來安裝這套軟體了。(仔細看 <code>install_sw4stm32_macos_64bits-v2.6.run</code> 這個 file，可以看到 bash 指令和一大串資料，所以才可以使用 bash 來執行)</p><h3 id=debugger>Debugger</h3><h4 id=st-linkv2>ST-LINK/V2</h4><p>此開發板本身有內建 <code>ST-LINK/V2</code>，這是提供給 <code>STM8</code> 和 <code>STM32</code> 的 hardware Debugger。透過 ST-LINK/V2，在執行 debug 模式時，就可以得知 General 和 I/O Registers 狀況，並且知道自己寫的程式正不正確。</p><blockquote><p>在 NUCLEO-F411RE 內建的 ST-LINK/V2 僅提供 <code>SWD (Serial Wire Debug)</code>Interface 去連接 STM32 Processor，但如果是外接的 ST-LINK/V2，就可以多支援 <code>JTAG (Joint Test Action Group)</code>。</p></blockquote><p><code>ST-LINK/V2</code> Debugger 的串接流程如下：
![openocd.png]({{ site.url }}/assets/images/openocd.png)</p><h4 id=openocd-and-gdb>OpenOCD and GDB</h4><p>有了 <code>ST-LINK/V2</code> ，我們可能還需要軟體層的 Debugger 來協助偵錯。目前大家常使用到的 Debugger 是 GDB，此外還需要一個中介層來連結 <code>ST-LINK/V2</code> 與 <code>GDB</code>，在 <code>SW4STM32</code> 是使用開放軟體 <a href=http://openocd.org/>OpenOCD</a> 。當使用者在按下 Debug 按鈕，會啟動 OpenOCD ，它先進行設定以透過 USB 連接到 STM32 上的 ST-LINK，然後使用 <code>3333</code> port 與 GDB 交換訊息。 此外還會使用 <code>4444</code> port 來接收使用者所下的指令。（意思是，使用者可以連接到 4444 port，接著輸入特定指令來查看 STM32 processor 執行情形）</p><p>上面有提到，在啟動 openOCD 時，它需要先進行設定，才可以正確地把程式下放到 processor 上。而這個設定檔會包含像是 processor 型號等，不過如果使用 <code>SW4STM32</code> ，使用者在選擇 device 型號階段，這樣的設定文件就會由系統自動設定完成。</p><p>一個標準 openOCD 的 .cfg 內容如下：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>configuration setup(s)
</span></span><span style=display:flex><span>source [find interface/stlink.cfg]
</span></span><span style=display:flex><span>set WORKAREASIZE 0x8000
</span></span><span style=display:flex><span>transport select &#34;hla_swd&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set CHIPNAME STM32F411RETx
</span></span><span style=display:flex><span>set BOARDNAME NUCLEO-F411RE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Enable debug when in low power modes
</span></span><span style=display:flex><span>set ENABLE_LOW_POWER 1
</span></span><span style=display:flex><span># Stop Watchdog counters when halt
</span></span><span style=display:flex><span>set STOP_WATCHDOG 1
</span></span><span style=display:flex><span># STlink Debug clock frequency
</span></span><span style=display:flex><span>set CLOCK_FREQ 4000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># use hardware reset, connect under reset
</span></span><span style=display:flex><span># connect_assert_srst needed if low power mode application running (WFI...)
</span></span><span style=display:flex><span>reset_config srst_only srst_nogate connect_assert_srst
</span></span><span style=display:flex><span>set CONNECT_UNDER_RESET 1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>source [find target/stm32f4x.cfg]
</span></span></code></pre></td></tr></table></div></div><p>話說，我們在執行安裝 <code>SW4STM32</code> 軟體流程時，會發現 <code>ST-LINK Server</code> 這個選擇性的軟體安裝， <code>ST-LINK Server</code> 可以用來將 debug information 傳給多個 Client，如此一來就可以同時使用不同軟體來接收 debug info。不過，在一般情況下，這軟體沒有很必要，因此不一定要安裝。</p><h3 id=check-st-linkv2-connection-status>Check ST-LINK/V2 Connection Status</h3><p>最後，要怎樣知道 ST-LINK/V2 已經和 PC 連接完成了呢？開發板上有一個 <code>LD1</code> 的 LED 燈，可以讓我們知道 ST-LINK/V2 和 PC 的連接狀況。通常可能會遇到 LD1 燈顯示<strong>紅色閃爍</strong>，代表它正在連接或是還沒有連接。如果連接成功，會<strong>持續亮紅色燈不閃爍</strong>。透過這樣的方式，我們就可以很快地知道連接狀態了！</p><h4 id=the-led1-status>The LED1 Status</h4><p>• Slow blinking Red/Off: at power-on before USB initialization</p><p>• Fast blinking Red/Off: after the first correct communication between the PC and
ST-LINK/V2-1 (enumeration)</p><p>• Red LED On: when the initialization between the PC and ST-LINK/V2-1 is complete</p><p>• Green LED On: after a successful target communication initialization</p><p>• Blinking Red/Green: during communication with target</p><p>• Green On: communication finished and successful</p><p>• Orange On: Communication failure</p><h2 id=reference>Reference</h2><ul><li><a href="http://ocw.nctu.edu.tw/course_detail.php?bgid=9&amp;gid=0&amp;nid=572">微處理機系統實驗 Microprocessor System Lab</a></li><li><a href=https://www.st.com/en/evaluation-tools/nucleo-f411re.html>NUCLEO-F411RE</a></li><li><a href=https://www.carminenoviello.com/2015/01/07/setting-gcceclipse-toolchain-stm32nucleo-part-2/>Setting up a GCC/Eclipse toolchain for STM32Nucleo</a></li></ul></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2018-10-05-study-9/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>9月份自我學習日誌回顧</span>
</a><a href=https://yushuanhsieh.github.io/posts/2018-11-02-aug-study/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>10月份自我學習日誌回顧</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>