<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Multilingual Mode in Hugo — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Multilingual Mode in Hugo</h1><div class=post-meta><time datetime=2020-04-07>April 7, 2020</time>
<span class=separator>·</span>
<span class=reading-time>13 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/go/>Go</a></div></header><div class=post-content><p>紀錄用 Hugo site generator 建立多語言網站時所遇到的問題，與過程中相關的學習內容，包含 Hugo render 過程、source code trace 等。</p><h2 id=預備知識>預備知識</h2><h3 id=the-flow-of-hugo-render>The flow of Hugo Render</h3><p>Hugo 是一個 Site Generator，那他是怎麼產出這些 static html 的呢？首先程式會先遍歷在 <code>content</code> folder 底下所有的 folder 和 file，並且組成一個 <code>contentTree</code> (題外話， contentTree 是採用 radix 資料結構)。然後再把這些 content node 根據 node type (e.g. type 可能是 sections or taxonomies) 去對應到 <code>layout</code> folder 內的 template，接著 render 出最後的 html 頁面。(也可參閱 <a href=https://github.com/gohugoio/hugo/blob/master/hugolib/site.go#L78>hugolib/site.go</a> 由 Hugo 開發者所寫的簡易流程)</p><p>從上述可以大概知道整個 Sites 的基本物件內容：</p><p><img src=/posts/3_hugo-multi-langs-hugo-sites.png alt=hugo></p><h3 id=multi-language-sites>Multi-language Sites</h3><p>有了前面的概念之後，就可以知道 multi-language site 是怎麼產出的了，它其實就是 render 成不同語言的獨立頁面，然後透過 path 來分類出當前的頁面是哪個語言，其目錄結構如下：</p><p><img src=/posts/hugo-multi-langs.png alt=hugo></p><p>而就是因為這樣的目錄結構，我們才可以簡單地在 path 加上 <code>/zh-tw/</code> ，就切換到繁中語言網站。</p><h2 id=langs-相關-variable--function-的說明與使用範例>Langs 相關 Variable / Function 的說明與使用範例</h2><p>Hugo 提供 Languages 相關的 variable 和 function，讓我們在寫 template 的時候拿來使用，所以下面會介紹幾個常用的 variable 和 function，並說明適當的使用時機。</p><h3 id=site-variables>Site Variables</h3><p>Site 有蠻多 Language 相關的 variable 可以使用，如下</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>.Site.IsMultiLingual
</span></span><span style=display:flex><span>.Site.Language.Lang
</span></span><span style=display:flex><span>.Site.Language.LanguageName
</span></span><span style=display:flex><span>.Site.Language.Weight
</span></span><span style=display:flex><span>.Site.Language
</span></span><span style=display:flex><span>.Site.LanguageCode
</span></span><span style=display:flex><span>.Site.LanguagePrefix
</span></span><span style=display:flex><span>.Site.Languages
</span></span></code></pre></td></tr></table></div></div><p>其中，這些 variable 的 output 大多與 hugo lang configuration 有關，例如:</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>languages</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>en</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>languageName</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;English&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>weight</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>tw</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>languageName</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;繁體中文&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>weight</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>對應的 <code>.Site.Language.Lang</code> 就是 <code>tw</code>；而 <code>.Site.Language.LanguageName</code> 就是 <code>繁體中文</code>。我會建議這個命名最好與其他 resources 設定一樣的命名規則，舉例來說，如果語言要顯示出對應的 icon，而 icon 的class name 是 <code>tw</code>，那麼這個名稱也要設定成 <code>tw</code>，如此一來在寫 template 的時候，就可以很方便的寫成：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>p</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>span</span> <span style=color:#1f2328>class</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;flag-icon-{{ .Site.Language.Lang }}&#34;</span><span style=color:#1f2328>&gt;&lt;/</span><span style=color:#0550ae>span</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>  .Site.Language.LanguageName
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>p</span><span style=color:#1f2328>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>(Note: Page 中也有 <code>.Language</code> variable，所以寫成 <code>.Language.Lang</code> 也是可以的。)</p><h3 id=page-variables>Page Variables</h3><p>Page 是 template 的 default context variable，而它所提供的 lang 相關 variable 如下：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>.IsTranslated
</span></span><span style=display:flex><span>.Translations
</span></span><span style=display:flex><span>.TranslationKey
</span></span><span style=display:flex><span>.Language
</span></span><span style=display:flex><span>.Sites.First
</span></span></code></pre></td></tr></table></div></div><p><code>.Language</code> 就不提了，因為跟 <code>.Site.Language</code> 一樣，比較重要的是 <code>.IsTranslated</code> 和 <code>.Translations</code>，官方文件在介紹時會提及一個範例：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span>{{ if .IsTranslated }}
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>h4</span><span style=color:#1f2328>&gt;</span>{{ i18n &#34;translations&#34; }}<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>h4</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>ul</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    {{ range .Translations }}
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>li</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>a</span> <span style=color:#1f2328>href</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;{{ .Permalink }}&#34;</span><span style=color:#1f2328>&gt;</span>{{ .Lang }}: {{ .Title }}{{ if .IsPage }} ({{ i18n &#34;wordCount&#34; . }}){{ end }}<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>a</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>li</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    {{ end }}
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>ul</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>{{ end }}
</span></span></code></pre></td></tr></table></div></div><p><code>.IsTranslated</code> 是說這個頁面有沒有提供其他語言版本， e.g. 如果只有 about.md ，那就是 false ，反之如果有 about.md 和 about.tw.md ，那就是 true。<code>IsTranslated</code> 在各 content page 會因為你提供的文件而有所差異，不過在 home page 基本上有提供語言設定的都會是 true。</p><p><code>.Translations</code> 是列出當前頁面所有翻譯版本的 Page，它 return 的結果會是 Page array，因此才會需要使用 <code>range</code>。舉例來說，我們提供 <code>about.md</code>, <code>about.tw.md</code>, <code>about.ja.md</code> 三個語言版本的頁面，而當前頁面是 en 版本，所以 <code>.Translations</code> 會回傳 <code>tw</code>, <code>ja</code> 兩語言的翻譯 Page。</p><p>而在 Page 迴圈當中，印出各 Page 的 language code，因此產出結果會變成：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>ul</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>li</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>a</span> <span style=color:#1f2328>href</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;www.example.com/tw/about&#34;</span><span style=color:#1f2328>&gt;</span>tw: 繁中版本字數20<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>a</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>a</span> <span style=color:#1f2328>href</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;www.example.com/ja/about&#34;</span><span style=color:#1f2328>&gt;</span>ja: 日文字數30<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>a</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>li</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>ul</span><span style=color:#1f2328>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>另外，<code>.Sites.First</code> 也是另一個可能會用到的 variable，<code>.Sites.First</code> 會回傳第一個語言的網站內容，用上述的例子來說，在 <code>tw</code> Site 使用 <code>.Sites.First</code>，結果就會是 <code>en</code> Site。通常我們會用在需要取得其他語言網站內容，後面會有使用實例。</p><h3 id=function>Function</h3><p>Language 相關的 function 包含：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>lang.Merge
</span></span><span style=display:flex><span>lang.NumFmt
</span></span></code></pre></td></tr></table></div></div><p>其中，<code>lang.Merge</code> 是蠻容易搞混的 function，所以特別提到它的用法和範例。根據官網文件， <code>lang.Merge</code> 的用途是結合其他語言的 page，讓沒有翻譯到的內容也可以使用其他語言來呈現。例如，當前 Site Language 是 <code>tw</code>，而某一個 Page 只有英文版本，這時候就可以使用 <code>lang.Merge</code> 功能來呈現英文內容。</p><p>官網範例如下：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span>{{ $pages := .Site.RegularPages }}
</span></span><span style=display:flex><span>{{ range .Site.Home.Translations }}
</span></span><span style=display:flex><span>  {{ $pages = $pages | lang.Merge .Site.RegularPages }}
</span></span><span style=display:flex><span>{{ end }}
</span></span></code></pre></td></tr></table></div></div><p><code>.Site.RegularPages</code> 是指特定語言 Site 的 leaf pages。</p><h4 id=補充什麼是-regularpages>補充：什麼是 RegularPages？</h4><p>RegularPages 簡單來說就是 <code>*.md</code> 這些 file 所產生的 page object，所以又被稱作 leaf page。在 Hugo 的世界中，萬物都是 Page，像是 section, taxonomy 這些也是以 Page 的型態存在 (Page 真正的型別是 Go interface)，但是真正包含文字內容的是 RegularPages，所以才會看到 template 中會有 <code>.Site.RegularPages</code> 這類的變數出現。</p><p>接著，</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span>{{ range .Site.Home.Translations }}
</span></span></code></pre></td></tr></table></div></div><p>如同上面提到， <code>.Translations</code> 是列出所有翻譯過的 Page，但是為什麼要特別指定 <code>.Site.Home</code> 呢？主要原因是 <code>.Site.Home</code> 意指網站的 home page ，而 home page 是每個翻譯版本都需要的 Page，所以透過 home page，才能真正的取得所有翻譯版本的 Page。如果只用 <code>.Translations</code> 的話，有可能當前 Page 並沒有其他翻譯版本，那就會回傳空 array。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span>{{ $pages = $pages | lang.Merge .Site.RegularPages }}
</span></span></code></pre></td></tr></table></div></div><p>剛剛取得到其他語言的 Page 之後，再使用 <code>.Site.RegularPages</code> 來取得該語言的所有 RegularPage，並且與當前語言的 RegularPage 結合，這樣就可以從其他語言中取得缺少的 Page。</p><p>再重新複習一下剛剛整段 code，我們假設當前的語言是 <code>en</code>，一樣有 <code>tw</code>, <code>ja</code> 其他兩種語言 Site。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>{{</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>$</span>pages<span style=color:#fff> </span><span style=color:#1f2328>:</span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>.</span>Site<span style=color:#1f2328>.</span>RegularPages<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>}}</span><span style=color:#fff> </span><span style=color:#0550ae>//</span><span style=color:#fff> </span>en<span style=color:#fff> </span>Site<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>中所有的</span><span style=color:#fff> </span>RegularPages<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>{{</span><span style=color:#fff> </span>range<span style=color:#fff> </span><span style=color:#1f2328>.</span>Site<span style=color:#1f2328>.</span>Home<span style=color:#1f2328>.</span>Translations<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>}}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>//</span><span style=color:#fff> </span><span style=color:#cf222e>Loop</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>其他翻譯語言的</span><span style=color:#fff> </span>Page<span style=color:#f6f8fa;background-color:#82071e>，此時</span><span style=color:#fff> </span>context<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>變成不同語言的</span><span style=color:#fff> </span>Page<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>//</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>因此</span><span style=color:#fff> </span><span style=color:#1f2328>.</span>Site<span style=color:#1f2328>.</span>RegularPages<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>是表示</span><span style=color:#fff> </span><span style=color:#0550ae>`</span>tw<span style=color:#0550ae>`</span><span style=color:#fff> </span><span style=color:#0550ae>`</span>ja<span style=color:#0550ae>`</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>這兩個語言的</span><span style=color:#fff> </span>RegularPage<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>//</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>雖然跟上面那行ㄧ樣，但實際的物件是完全不同的～</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#f6f8fa;background-color:#82071e>{{</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>$</span>pages<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>$</span>pages<span style=color:#fff> </span><span style=color:#0550ae>|</span><span style=color:#fff> </span>lang<span style=color:#1f2328>.</span>Merge<span style=color:#fff> </span><span style=color:#1f2328>.</span>Site<span style=color:#1f2328>.</span>RegularPages<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>}}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>//</span><span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>將</span><span style=color:#fff> </span>Pages<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>合併，產生新的</span><span style=color:#fff> </span>Pages<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>{{</span><span style=color:#fff> </span>end<span style=color:#fff> </span><span style=color:#f6f8fa;background-color:#82071e>}}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>這樣聽起來 <code>lang.Merge</code> 好像很強大，如果有些內容來不及翻譯，就可以直接使用 default lang page 來替代。但實際上並沒有如此好用，使用 <code>lang.Merge</code> 的前提條件是該 page 會進入到 render 階段，我們才有辦法透過 template 來 merge 兩種語言的內容，如果那個 page 本身並不存在於 Site 當中，那他就不會 render，此時當然就無法使用 <code>lang.Merge</code> 功能。</p><p>舉個例子，如果我們有 <code>en</code> 和 <code>tw</code> 兩個語言的 Site，但是只有 <code>about.md</code> 英文版本的內容，缺少了 <code>about.tw.md</code> 文件，此時即使我們在 <code>layout/about</code> 加入 <code>lang.Merge</code> ㄧ樣沒用，因為缺少 <code>about.tw.md</code>，<code>tw</code> Site 就不會有 about page object，進而就不會進入 template render。</p><h2 id=問題share-a-content-to-different-language-sites>問題：share a content to different language sites</h2><p>綜合以上的說明，可以發現使用 Hugo build 多語言的網站時，會遇到一個問題，就是一定要有 <code>*.tw.md</code> 這類語言頁面 file 的存在，才會產出該頁面，而 <code>lang.Merge</code> 並無法有效解決該類問題。在 Hugo issues 中也看到不少 user 建議要有 <code>merge content with default language content</code>，像是 <a href=https://github.com/gohugoio/hugo/issues/5612>Issues #5612</a>，而 Hugo 開發者也認同此建議，只是他也點出做這功能的複雜度，像是： merge 要以哪個語言為主？如果使用 merge，那 Hugo 會產出大量不同語言但是其實內容一樣的 html，Google search 表示無奈。</p><p>因此雖然有這個 Proposal，但是目前被持續遞延到下一個版本。在沒有其他官方作法之前，網友有提供各種方式來暫時解決此問題，像是建立 symbolic link <code>ln -s about.md about.tw.md</code> 等。</p><h2 id=結論>結論</h2><p>Hugo 的多語言網站建立還是有其限制，因此在使用 Hugo 建立商業官方網站之前，最好先評估一下是否可以接受這點，不然直接使用 javascript front-end framework 搭配 i18n，可能比處理這些流程還要好些。</p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2020-03-31-march/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>三月起，在竹北定區生活</span>
</a><a href=https://yushuanhsieh.github.io/posts/2020-04-15-transfer-sh-refactor/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>Trace transfer.sh open project</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>