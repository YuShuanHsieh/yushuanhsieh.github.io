<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>CSE 506 Lab1 - The Stack — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>CSE 506 Lab1 - The Stack</h1><div class=post-meta><time datetime=2020-08-25>August 25, 2020</time>
<span class=separator>·</span>
<span class=reading-time>13 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/operating-system/>Operating System</a></div></header><div class=post-content><h2 id=前言>前言</h2><p>課程 <a href=https://www.cs.unc.edu/~porter/courses/comp790/s20/index.html>Operating System Implementation</a>，Lab1 <a href=https://www.cs.unc.edu/~porter/courses/comp790/s20/lab1.html>x86 Assembly and Bootloader</a> 是個簡單的實作開場(Lab 源自於 MIT 課程)，不過其中卻有蠻多學習的地方。這次來記錄一下 Lab 1 中的 <strong>The Stack</strong> 實作部分，實作過程中除了需要用 gdb 之外，也需要搭配 asm code。</p><h2 id=實作內容>實作內容</h2><p>在教學程式中，會呼叫 test_backtrace(5)，接著跑 recursion 直到碰到終止條件為止。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>i386_init</span><span style=color:#1f2328>(</span><span style=color:#cf222e>void</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#6639ba>test_backtrace</span><span style=color:#1f2328>(</span><span style=color:#0550ae>5</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>test_backtrace</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;entering test_backtrace %d</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>,</span> x<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>x <span style=color:#0550ae>&gt;</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>        <span style=color:#6639ba>test_backtrace</span><span style=color:#1f2328>(</span>x<span style=color:#0550ae>-</span><span style=color:#0550ae>1</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>else</span>
</span></span><span style=display:flex><span>        <span style=color:#6639ba>mon_backtrace</span><span style=color:#1f2328>(</span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;leaving test_backtrace %d</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>,</span> x<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>我們的目標，就是實作 <code>mon_backtrace</code>，追蹤進入 test_backtrace function 以及 recursion 的過程。</p><p><img src=/posts/os-lab1_1.png alt=hugo></p><h2 id=x86-base-pointer--stack-frame>x86 Base Pointer & Stack Frame</h2><p>而在這實作中，我們使用一個 register:</p><h3 id=rbpbp>RBP(BP)</h3><blockquote><p>Stack Base Pointer register (BP). Used to point to the base of the stack.</p></blockquote><p>來作為我們取得其他資訊的基點。</p><p>不過在實作之前，需要了解基本的 x86_64 stack frame 架構，參考 <a href=https://eli.thegreenplace.net/2011/09/06/stack-frame-layout-on-x86-64.html>Stack frame layout on x86-64</a>，可以有個基本概念：</p><p><img src=https://eli.thegreenplace.net/images/2011/08/x64_frame_nonleaf.png alt="x86_64 stack frame"></p><p>從圖中知道 function params、return address、local variables 在 stack 中的記憶體相對位置，所以透過位移，就可以得到對應數值。</p><p>接著我們透過 asm code 來了解 RBP 數值變化。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-S data-lang=S><span style=display:flex><span><span style=color:#0550ae>8004200058</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>55</span>                   	push   <span style=color:#0550ae>%rbp
</span></span></span><span style=display:flex><span><span style=color:#0550ae>8004200059:	48 89 e5             	mov    %</span>rsp<span style=color:#1f2328>,</span><span style=color:#0550ae>%rbp
</span></span></span><span style=display:flex><span><span style=color:#0550ae>800420005c:	48 83 ec 10          	sub    $0x10,%</span>rsp
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200060</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>89</span> <span style=color:#0550ae>7</span>d fc             	mov    <span style=color:#0550ae>%edi,-0x4(%</span>rbp<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;entering test_backtrace %d\n&#34;</span><span style=color:#1f2328>,</span> x<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200063</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>8</span>b <span style=color:#0550ae>45</span> fc             	mov    <span style=color:#0550ae>-0</span><span style=color:#6639ba>x4</span><span style=color:#1f2328>(</span><span style=color:#0550ae>%rbp),%</span>eax
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200066</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>89</span> c6                	mov    <span style=color:#0550ae>%eax,%</span>esi
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200068</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>48</span> bf c0 <span style=color:#0550ae>93</span> <span style=color:#0550ae>20</span> <span style=color:#0550ae>04</span> <span style=color:#0550ae>80</span> 	movabs <span style=color:#0550ae>$</span><span style=color:#0550ae>0x80042093c0</span><span style=color:#1f2328>,</span><span style=color:#0550ae>%rdi
</span></span></span><span style=display:flex><span><span style=color:#0550ae>800420006f:	00 00 00 
</span></span></span><span style=display:flex><span><span style=color:#0550ae>8004200072:	b8 00 00 00 00       	mov    $0x0,%</span>eax
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200077</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>48</span> ba ad <span style=color:#0550ae>15</span> <span style=color:#0550ae>20</span> <span style=color:#0550ae>04</span> <span style=color:#0550ae>80</span> 	movabs <span style=color:#0550ae>$</span><span style=color:#0550ae>0x80042015ad</span><span style=color:#1f2328>,</span><span style=color:#0550ae>%rdx
</span></span></span><span style=display:flex><span><span style=color:#0550ae>800420007e:	00 00 00 
</span></span></span><span style=display:flex><span><span style=color:#0550ae>8004200081:	ff d2                	callq  *%</span>rdx
</span></span><span style=display:flex><span><span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>x <span style=color:#0550ae>&gt;</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200083</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>83</span> <span style=color:#0550ae>7</span>d fc <span style=color:#0550ae>00</span>          	cmpl   <span style=color:#0550ae>$</span><span style=color:#0550ae>0x0</span><span style=color:#1f2328>,</span><span style=color:#0550ae>-0</span><span style=color:#6639ba>x4</span><span style=color:#1f2328>(</span>%rbp<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#0550ae>8004200087</span><span style=color:#0550ae>:</span>	<span style=color:#0550ae>7</span>e <span style=color:#0550ae>16</span>                	jle    <span style=color:#0550ae>800420009</span>f <span style=color:#0550ae>&lt;</span>test_backtrace<span style=color:#0550ae>+0</span>x47<span style=color:#0550ae>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#6639ba>test_backtrace</span><span style=color:#1f2328>(</span>x<span style=color:#0550ae>-1</span><span style=color:#1f2328>);</span>
</span></span></code></pre></td></tr></table></div></div><p>用圖示來表示：</p><p><img src=/posts/os-lab1_2.png alt=hugo></p><p>由於每次進入 <code>test_backtrace</code> 就會把前一個 RBP 地址 PUSH 到 stack 中，所以可以透過讀取 RBP 的值來移動到上一個 function 的 stack frame。藉由這樣的方式，就能持續地往前追朔 function。</p><p>那這向前追朔的過程要到什麼時候才要停止呢？</p><p>看 <code>kern/entry.S:63</code> 這段 source code，會發現：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span>movq	<span style=color:#f6f8fa;background-color:#82071e>$</span><span style=color:#0550ae>0x0</span><span style=color:#1f2328>,</span><span style=color:#0550ae>%</span>rbp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># Set the stack pointer
</span></span></span><span style=display:flex><span>movabs	<span style=color:#f6f8fa;background-color:#82071e>$</span><span style=color:#1f2328>(</span>bootstacktop<span style=color:#1f2328>),</span><span style=color:#0550ae>%</span>rax
</span></span><span style=display:flex><span>movq  <span style=color:#0550ae>%</span>rax<span style=color:#1f2328>,</span><span style=color:#0550ae>%</span>rsp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># now to C code
</span></span></span><span style=display:flex><span>movabs <span style=color:#f6f8fa;background-color:#82071e>$</span>i386_init<span style=color:#1f2328>,</span> <span style=color:#0550ae>%</span>rax
</span></span><span style=display:flex><span>call <span style=color:#0550ae>*%</span>rax
</span></span></code></pre></td></tr></table></div></div><p><code>%rbp</code> 的值被設置為 0 後，才進入到 i386_init function 並執行 test_backtrace function，這意味著只要持續讀取 %rbp 的值，直到 %rbp 值為 0 即可停止。</p><p>有了這樣的概念後，就可以來實作一部分的 code：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>mon_backtrace</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> argc<span style=color:#1f2328>,</span> <span style=color:#cf222e>char</span> <span style=color:#0550ae>**</span>argv<span style=color:#1f2328>,</span> <span style=color:#cf222e>struct</span> Trapframe <span style=color:#0550ae>*</span>tf<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>uint64_t</span> rbp <span style=color:#0550ae>=</span> <span style=color:#6639ba>read_rbp</span><span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>while</span><span style=color:#1f2328>(</span>rbp <span style=color:#0550ae>!=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        rbp <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>rbp<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>說明一下 <code>read_rbp</code> 這個 function，function 的 code 為：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>static</span> <span style=color:#cf222e>__inline</span> <span style=color:#cf222e>uint64_t</span> <span style=color:#6639ba>read_rbp</span><span style=color:#1f2328>(</span><span style=color:#cf222e>void</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>uint64_t</span> rbp<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>__asm</span> <span style=color:#6639ba>__volatile</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;movq %%rbp,%0&#34;</span> <span style=color:#0550ae>:</span> <span style=color:#0a3069>&#34;=r&#34;</span> <span style=color:#1f2328>(</span>rbp<span style=color:#1f2328>)</span><span style=color:#0550ae>::</span><span style=color:#0a3069>&#34;cc&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;memory&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>return</span> rbp<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>值得注意的是 <code>"cc"</code>, <code>"memory"</code> 這兩個 clobber arguments，根據 <a href=https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#Clobbers>GNU 6.47.2 Extended Asm</a>：</p><blockquote><p>&ldquo;cc&rdquo;
The &ldquo;cc&rdquo; clobber indicates that the assembler code modifies the flags register. On some machines, GCC represents the condition codes as a specific hardware register; &ldquo;cc&rdquo; serves to name this register. On other machines, condition code handling is different, and specifying &ldquo;cc&rdquo; has no effect. But it is valid no matter what the target.</p></blockquote><p>如果 instruction 會修改 flag tegister ，那就要標記 &ldquo;cc&rdquo; (condition codes)。不過以 x86 的 MOV instruction 來說， MOV 並不會對 flag tegister 造成任何影響，因此即使沒有加註也不會發生錯誤。</p><blockquote><p>&ldquo;memory&rdquo;
The &ldquo;memory&rdquo; clobber tells the compiler that the assembly code performs memory reads or writes to items other than those listed in the input and output operands. Further, the compiler does not assume that any values read from memory before an asm remain unchanged after that asm; it reloads them as needed. Using the &ldquo;memory&rdquo; clobber effectively forms a read/write memory barrier for the compiler.</p></blockquote><p>至於 &ldquo;memory&rdquo; 則是說明 asm code 有可能讀取非預期的記憶體位置，以及我認為比較重要的是有 read/write memory barrier 效果，由於 GNU gcc 編譯器在優化時，可能會改變記憶體讀取順序，透過 &ldquo;memory&rdquo; 在一些情況下能夠確保值是正確的。(其他範例與解釋可以參考<a href=https://0xax.gitbooks.io/linux-insides/content/Theory/linux-theory-3.html>Inline assembly</a>)。</p><p>而對於 read_rbp 來說，&ldquo;memory&rdquo; 有沒有加都不會影響編譯後的結果。</p><h3 id=rip>RIP</h3><p>x86_64 的 RIP 指的是 64-bit Instruction Pointer ，不過在實作題目的 RIP 意思有點不同，是指 <strong>&ldquo;Return&rdquo;</strong> Instruction Pointer，也就是上面在 stack frame layout 圖中標示的 return address。</p><blockquote><p>The RIP value is the function&rsquo;s <strong>return instruction pointer</strong>: the instruction address to which control will return when the function returns.</p></blockquote><p>根據 stack frame layout， return address 是在 rbp 上方位置，也就是 <code>%rip + 8</code>，因此我們要做的就是把這個地址的值讀出來即可。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>mon_backtrace</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> argc<span style=color:#1f2328>,</span> <span style=color:#cf222e>char</span> <span style=color:#0550ae>**</span>argv<span style=color:#1f2328>,</span> <span style=color:#cf222e>struct</span> Trapframe <span style=color:#0550ae>*</span>tf<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>uint64_t</span> rip <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>uint64_t</span> rbp <span style=color:#0550ae>=</span> <span style=color:#6639ba>read_rbp</span><span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>while</span><span style=color:#1f2328>(</span>rbp <span style=color:#0550ae>!=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        rbp <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>rbp<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>        rip <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)(</span>rbp <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=dwarf>DWARF</h3><p>最後一個實作條件，就是要從 DWARF(Debugging With Attributed Record Formats) 中取得 function params 數量和值。</p><p>由於多數現代化的程式語言架構是由多個階層式 block 組成，DWARF 運用這特性將程式拆解成樹狀結構，並包含相關資訊（例如參數的大小、類型等），以利使用者查詢。近期 news 也有提到 <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=GCC-11-DWARF-5-Possible-Default">GCC 11 Compiler Might Finally Enable DWARF 5 Debugging By Default</a>，因此從此 Lab 實作中開始學習接觸 DWARF ，也是不錯的出發點。DWARF 介紹可參閱 <a href=http://www.dwarfstd.org/doc/Debugging%20using%20DWARF-2012.pdf>Introduction to the DWARF Debugging Format</a>。</p><p>Lab 1 的 source code 把讀取 DWARF 資訊過程包裝成較高階層的 function <code>debuginfo_rip</code>，以利課程使用，其 <code>Ripdebuginfo</code> struct 為：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>struct</span> Ripdebuginfo <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>const</span> <span style=color:#cf222e>char</span> <span style=color:#0550ae>*</span>rip_file<span style=color:#1f2328>;</span>		<span style=color:#57606a>// Source code filename for RIP
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> rip_line<span style=color:#1f2328>;</span>			<span style=color:#57606a>// Source code linenumber for RIP
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>const</span> <span style=color:#cf222e>char</span> <span style=color:#0550ae>*</span>rip_fn_name<span style=color:#1f2328>;</span>	<span style=color:#57606a>// Name of function containing RIP
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> rip_fn_namelen<span style=color:#1f2328>;</span>		<span style=color:#57606a>// Length of function name
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>uintptr_t</span> rip_fn_addr<span style=color:#1f2328>;</span>		<span style=color:#57606a>// Address of start of function
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> rip_fn_narg<span style=color:#1f2328>;</span>		<span style=color:#57606a>// Number of function arguments
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> size_fn_arg<span style=color:#1f2328>[</span><span style=color:#0550ae>10</span><span style=color:#1f2328>];</span>		<span style=color:#57606a>// Sizes of each of function arguments
</span></span></span><span style=display:flex><span>    <span style=color:#cf222e>uintptr_t</span> offset_fn_arg<span style=color:#1f2328>[</span><span style=color:#0550ae>10</span><span style=color:#1f2328>];</span>	<span style=color:#57606a>// Offset of each of function arguments (from CFA)
</span></span></span><span style=display:flex><span>    Dwarf_Regtable reg_table<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span></code></pre></td></tr></table></div></div><p>根據需求，實作中需要列印出 function params 的數量和值，因此我們將目光放在 <code>rip_fn_narg</code>、<code>size_fn_arg</code>、<code>offset_fn_arg</code> 這三個 member 上。</p><p><code>rip_fn_narg</code>、<code>size_fn_arg</code> 這兩個非常好理解，但是 <code>offset_fn_arg</code> 這又該怎麼解釋，以及 offset 的基準點是什麼？</p><h4 id=解析-offset_fn_arg>解析 offset_fn_arg</h4><p>首先 <code>offset_fn_arg</code> 的註解是：</p><blockquote><p>Offset of each of function arguments (from CFA)</p></blockquote><p>先來查看 CFA 的意思，從 <a href=http://dwarfstd.org/doc/Dwarf3.pdf>DWARF format DOC</a> 可以看到解釋：</p><blockquote><p>An area of memory that is allocated on a stack called a “call frame.” The call frame is identified by an address on the stack. We refer to this address as the Canonical Frame Address or CFA.</p></blockquote><p>了解 CFA 的意思，接下來就來看一下 <code>offset_fn_arg</code> 這個值是從哪裡來的，追蹤一下 source code。 <code>debuginfo_rip</code> function 會呼叫 <code>_dwarf_frame_params_init</code> function：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>void</span> <span style=color:#6639ba>_dwarf_frame_params_init</span><span style=color:#1f2328>(</span>Dwarf_Debug dbg<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#57606a>/* Initialise call frame related parameters. */</span>
</span></span><span style=display:flex><span>dbg<span style=color:#0550ae>-&gt;</span>dbg_frame_rule_table_size <span style=color:#0550ae>=</span> DW_FRAME_LAST_REG_NUM<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>dbg<span style=color:#0550ae>-&gt;</span>dbg_frame_rule_initial_value <span style=color:#0550ae>=</span> DW_FRAME_REG_INITIAL_VALUE<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>dbg<span style=color:#0550ae>-&gt;</span>dbg_frame_cfa_value <span style=color:#0550ae>=</span> DW_FRAME_CFA_COL3<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>dbg<span style=color:#0550ae>-&gt;</span>dbg_frame_same_value <span style=color:#0550ae>=</span> DW_FRAME_SAME_VAL<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>dbg<span style=color:#0550ae>-&gt;</span>dbg_frame_undefined_value <span style=color:#0550ae>=</span> DW_FRAME_UNDEFINED_VAL<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>從 <code>_dwarf_frame_params_init</code> 了解接下來的流程就是從 DWARF info 中讀取 function params 相關資訊。然後，我們快速地跳到 <code>offset_fn_arg</code> assign 過程：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#57606a>// list_func_die function
</span></span></span><span style=display:flex><span><span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>atom <span style=color:#0550ae>==</span> DW_OP_fbreg<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>uint8_t</span> <span style=color:#0550ae>*</span>p <span style=color:#0550ae>=</span> loc_ptr<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    ret_offset <span style=color:#0550ae>=</span> <span style=color:#6639ba>_dwarf_decode_sleb128</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span>p<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    offset <span style=color:#0550ae>+=</span> p <span style=color:#0550ae>-</span> loc_ptr<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    loc_ptr <span style=color:#0550ae>=</span> p<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>info<span style=color:#0550ae>-&gt;</span>offset_fn_arg<span style=color:#1f2328>[</span>info<span style=color:#0550ae>-&gt;</span>rip_fn_narg<span style=color:#1f2328>]</span><span style=color:#0550ae>=</span>ret_offset<span style=color:#1f2328>;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到關建字 <code>DW_OP_fbreg</code>，搜尋 DWARF 手冊：</p><blockquote><p>DW_OP_fbreg:
The DW_OP_fbreg operation provides a signed LEB128 offset from the address specified by the location description in the DW_AT_frame_base attribute of the current function.</p></blockquote><p>這樣就能知道，<code>offset_fn_arg</code> 就是以 <code>DW_AT_frame_base</code> 這個 attribute 為基準的 offset 值。</p><p>至於 <code>DW_AT_frame_base</code> attribute 就是指 <strong>base frame pointer</strong>，而根據 <a href=http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html>Stack Organization</a> 可以知道， current stack frame layout 是從 return address 開始算起，因此我們在計算 base frame address，就要 +8 (old rbp value) +8 (return address value)：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#57606a>// read DWARF info from RIP (return IP)
</span></span></span><span style=display:flex><span><span style=color:#cf222e>struct</span> Ripdebuginfo info<span style=color:#1f2328>;</span> 
</span></span><span style=display:flex><span><span style=color:#cf222e>int</span> ret <span style=color:#0550ae>=</span> <span style=color:#6639ba>debuginfo_rip</span><span style=color:#1f2328>((</span><span style=color:#cf222e>uintptr_t</span><span style=color:#1f2328>)</span>rip<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>info<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>uint64_t</span> rbp <span style=color:#0550ae>=</span> <span style=color:#6639ba>read_rbp</span><span style=color:#1f2328>();</span> <span style=color:#57606a>//current RBP
</span></span></span><span style=display:flex><span><span style=color:#cf222e>uint64_t</span> prev_rbp <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>rbp<span style=color:#1f2328>;</span> <span style=color:#57606a>// back to the previous RBP
</span></span></span><span style=display:flex><span><span style=color:#cf222e>uint64_t</span> frame_base <span style=color:#0550ae>=</span> prev_rbp <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span> <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>;</span>
</span></span></code></pre></td></tr></table></div></div><p>接著讀取 <code>offset_fn_arg</code> 的值，以 Lab 1 來說，第一個 params 的 offset 值是 -20，接著再把 base frame address + (-20)，因為 x86 的 stack 是從 high address 往 low address 成長。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#57606a>// read DWARF info from RIP (return IP)
</span></span></span><span style=display:flex><span><span style=color:#cf222e>struct</span> Ripdebuginfo info<span style=color:#1f2328>;</span> 
</span></span><span style=display:flex><span><span style=color:#cf222e>int</span> ret <span style=color:#0550ae>=</span> <span style=color:#6639ba>debuginfo_rip</span><span style=color:#1f2328>((</span><span style=color:#cf222e>uintptr_t</span><span style=color:#1f2328>)</span>rip<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>info<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>uint64_t</span> rbp <span style=color:#0550ae>=</span> <span style=color:#6639ba>read_rbp</span><span style=color:#1f2328>();</span> <span style=color:#57606a>//current RBP
</span></span></span><span style=display:flex><span><span style=color:#cf222e>uint64_t</span> prev_rbp <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>rbp<span style=color:#1f2328>;</span> <span style=color:#57606a>// back to the previous RBP
</span></span></span><span style=display:flex><span><span style=color:#cf222e>uint64_t</span> frame_base <span style=color:#0550ae>=</span> prev_rbp <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span> <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>int</span> argc <span style=color:#0550ae>=</span> info<span style=color:#1f2328>.</span>rip_fn_narg<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>for</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> i <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span> i <span style=color:#0550ae>&lt;</span> argc<span style=color:#1f2328>;</span> i<span style=color:#0550ae>++</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> offset <span style=color:#0550ae>=</span> info<span style=color:#1f2328>.</span>offset_fn_arg<span style=color:#1f2328>[</span>i<span style=color:#1f2328>];</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>uint64_t</span> arg <span style=color:#0550ae>=</span> frame_base <span style=color:#0550ae>+</span> offset<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// TODO: we should check the size of args to the display correct value 
</span></span></span><span style=display:flex><span>    <span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%016d &#34;</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint32_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>arg<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最後再根據 params 的 size <code>size_fn_arg</code> 來顯示出正確的數值。(因為 test_backtrace 的 params size 是 4 byte，所以我就直接用 uint32_t 來顯示了)</p><h2 id=完整-code>完整 code</h2><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>mon_backtrace</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> argc<span style=color:#1f2328>,</span> <span style=color:#cf222e>char</span> <span style=color:#0550ae>**</span>argv<span style=color:#1f2328>,</span> <span style=color:#cf222e>struct</span> Trapframe <span style=color:#0550ae>*</span>tf<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>uint64_t</span> rip <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>,</span> rbp <span style=color:#0550ae>=</span> <span style=color:#6639ba>read_rbp</span><span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>	<span style=color:#6639ba>read_rip</span><span style=color:#1f2328>(</span>rip<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>	<span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Stack backtrace:</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>while</span><span style=color:#1f2328>(</span>rbp <span style=color:#0550ae>!=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>){</span>
</span></span><span style=display:flex><span>		<span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34; rbp %016x rip %016x</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>,</span> rbp<span style=color:#1f2328>,</span> rip<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>struct</span> Ripdebuginfo info<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>int</span> ret <span style=color:#0550ae>=</span> <span style=color:#6639ba>debuginfo_rip</span><span style=color:#1f2328>((</span><span style=color:#cf222e>uintptr_t</span><span style=color:#1f2328>)</span>rip<span style=color:#1f2328>,</span> <span style=color:#0550ae>&amp;</span>info<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span>ret <span style=color:#0550ae>!=</span> <span style=color:#0550ae>-</span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>			<span style=color:#cf222e>int</span> narg <span style=color:#0550ae>=</span> info<span style=color:#1f2328>.</span>rip_fn_narg<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>			<span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%s:%d: %s+%016d args:%d &#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>				info<span style=color:#1f2328>.</span>rip_file<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>				info<span style=color:#1f2328>.</span>rip_line<span style=color:#1f2328>,</span>info<span style=color:#1f2328>.</span>rip_fn_name<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>				rip<span style=color:#0550ae>-</span>info<span style=color:#1f2328>.</span>rip_fn_addr<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>				narg<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#57606a>// The frame base begins from return address
</span></span></span><span style=display:flex><span>			<span style=color:#cf222e>uint64_t</span> frame_base <span style=color:#0550ae>=</span> rbp <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span> <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>			<span style=color:#cf222e>for</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> i <span style=color:#0550ae>=</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span> i <span style=color:#0550ae>&lt;</span> narg<span style=color:#1f2328>;</span> i<span style=color:#0550ae>++</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>				<span style=color:#cf222e>int</span> offset <span style=color:#0550ae>=</span> info<span style=color:#1f2328>.</span>offset_fn_arg<span style=color:#1f2328>[</span>i<span style=color:#1f2328>];</span>
</span></span><span style=display:flex><span>				<span style=color:#cf222e>uint64_t</span> arg <span style=color:#0550ae>=</span> frame_base <span style=color:#0550ae>+</span> offset<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>				<span style=color:#57606a>// TODO: we should check the size of args to display correct value 
</span></span></span><span style=display:flex><span>				<span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%016d &#34;</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint32_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>arg<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>			<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>		<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>		<span style=color:#6639ba>cprintf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;</span><span style=color:#0a3069>\n</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		rip <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)(</span>rbp <span style=color:#0550ae>+</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>		rbp <span style=color:#0550ae>=</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>(</span><span style=color:#cf222e>uint64_t</span> <span style=color:#0550ae>*</span><span style=color:#1f2328>)</span>rbp<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#cf222e>return</span> <span style=color:#0550ae>0</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=結論>結論</h2><p>透過這個作業可以確實地理解 stack frame ，並且對 DWARF 有初步了解，整體來說不難，但是還蠻有啟發性的。</p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2020-08-24-comp790-tool/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>CSE 506 Lab 環境建置</span>
</a><a href=https://yushuanhsieh.github.io/posts/2020-09-04-vault-security/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>Vault Initialization and Keys Security</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>