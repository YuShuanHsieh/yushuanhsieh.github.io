<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Run Go applications on Raspberry Pi Pico using TinyGo — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Run Go applications on Raspberry Pi Pico using TinyGo</h1><div class=post-meta><time datetime=2021-10-01>October 1, 2021</time>
<span class=separator>·</span>
<span class=reading-time>16 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/raspberry-pi/>Raspberry Pi</a>
<a href=https://yushuanhsieh.github.io/categories/go/>Go</a></div></header><div class=post-content><p><a href=https://github.com/tinygo-org/tinygo>TinyGo - Go compiler for small places.</a> TinyGo 自 2019 年正式公開以來，就逐漸受到關注，尤其是 Google 在 2019 年 <a href=https://go.dev/blog/10years>10 years of Go</a> 也有特別提到 Go 原本將目標放在網路或是雲端等應用程式，不過未來期望能夠更廣泛地應用在 microcontroller 上。在近期 TinyGo 開始支援 Raspberry Pi Pico，再加上 TinyGo 架構也逐漸成熟，因此就來試用看看。</p><h2 id=run-applications-on-raspberry-pi-pico>Run applications on Raspberry Pi Pico</h2><p>在分析 TinyGo 如何編譯適合跑在 Raspberry Pi Pico 的 Go program 之前，先來複習如何讓 user application 在 Raspberry Pi Pico (以下皆簡稱為 Pico) 上執行。在 Pico 進入 user application 的 entry point 之前，會有幾個前置流程，包含：</p><ol><li>hardware controlled boot</li><li>enter the bootroom from ROM</li><li>initialize CPU</li><li>load second boot loader to RAM</li><li>jump to the entry point of second boot loader</li><li>setup the flash to XIP mode</li><li>jump to the entry point of application</li></ol><p>根據 Pico firmware 架構，second boot loader 是被放在 <a href=https://github.com/raspberrypi/pico-sdk/tree/master/src/rp2_common/boot_stage2>pico-sdk repository</a> 中，當 user 使用 Pico 原生的 pico-sdk 來編譯自己所撰寫的程式時，會連同 second boot loader 一起編譯成最終的執行程式，並且放置到 flash 起始位置 (0x10000000)，如此一來 Pico 在退出 bootroom 後，就會從 0x10000000 位置開始執行後續流程 (Pico default memory layout 圖示可參考 <a href=https://yushuanhsieh.github.io/post/2021-06-19-pico-memory/>Boot Flow of Raspberry Pi Pico</a>)。</p><p>而這點也意味著，透過 TinyGo 所編譯出來的執行程式，除了 user application 之外，還必須包含 second boot loader，並且也要預留對應的 stack 空間，才能讓 Pico 正確進入到對應的 entry point 並執行程式。</p><h2 id=how-tinygo-works>How TinyGo works</h2><p>在 TinyGo <a href=https://tinygo.org/docs/concepts/compiler-internals/pipeline/>Pipeline documentation</a> 中有簡單介紹 TinyGo compiler 流程：</p><p><img src=/posts/tinygo-flow.png alt="tinygo flow"></p><p>在我認為，TinyGo 這個 project 扮演著整合的角色，可以看到在 compiler front end 和 back end 處理，主要是運用既有的 Go compiler libraries 和成熟的 LLVM 架構，在過程中進行額外的調整處理，使其最後產出的 object file 能夠更符合 microcontroller 本身的硬體條件。</p><p>首先，以 Pico device 為例，來分析 TinyGo 如何支援各種不同的 device。</p><h3 id=json-config-file>json config file</h3><p>在使用 TinyGo compile Go source code 的時候，我們會下以下指令：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>tinygo build -o hello -target<span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;pico&#34;</span> ./hello.go
</span></span></code></pre></td></tr></table></div></div><p>而這裡的 option <code>target</code> 具體指的就是 TinyGo 針對不同 device 硬體架構而事先配置好的 json <a href=https://github.com/tinygo-org/tinygo/tree/release/targets>config file</a>。以 Pico 來說，它的 config file 內容如下：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#57606a>// tinygo/targets/pico.json
</span></span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;inherits&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;rp2040&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;build-tags&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;pico&#34;</span><span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;serial&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;uart&#34;</span><span style=color:#1f2328>,</span> <span style=color:#57606a>// build be usb or uart
</span></span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;linkerscript&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;targets/pico.ld&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;extra-files&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;targets/pico-boot-stage2.S&#34;</span> <span style=color:#57606a>// bootloader
</span></span></span><span style=display:flex><span>    <span style=color:#1f2328>]</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>可以觀察到 config 提供相關 serial output 和 linker script 資訊，以及我們在上述所提及到 second boot loader source code。此外，config file 採用物件繼承的架構，讓 device 重複使用相同 microcontroller 的設定，像是 Pico 就繼承 <code>rp2040</code> config：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#57606a>// tinygo/targets/rp2040.json
</span></span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;inherits&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;cortex-m0plus&#34;</span><span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;build-tags&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;rp2040&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;rp&#34;</span><span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;flash-method&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;msd&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;msd-volume-name&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;RPI-RP2&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;msd-firmware-name&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;firmware.uf2&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;binary-format&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;uf2&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;uf2-family-id&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;0xe48bff56&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;rp2040-boot-patch&#34;</span><span style=color:#1f2328>:</span> <span style=color:#cf222e>true</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;extra-files&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;src/device/rp/rp2040.s&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;openocd-transport&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;swd&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;openocd-target&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;rp2040&#34;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></td></tr></table></div></div><p>而在 rp2040 config 可以看到更多針對 microcontroller 的設定，其內容主要是參考 RP2040 datasheet，以 <code>binary-format</code> 和 <code>uf2-family-id</code> 為例，在 <a href=https://datasheets.raspberrypi.org/rp2040/rp2040-datasheet.pdf>datasheet 2.8.3.2 UF2 Format Details</a> 有提到關於 UF2 的需求：</p><blockquote><p>All data destined for the device must be in a UF2 block with familyID present and set to <em>0xe48bff56</em>, and a payload_size
of 256.</p></blockquote><p>總而言之，TinyGo <code>target</code> option 以及其對應 json config 最主要的目的，是能夠更彈性地讓 compiler 針對不同 device 硬體配置而調整編譯內容和方式。</p><h3 id=linker-script>linker script</h3><p>要讓程式正確執行的另一個重點，就是要告知 linker 的記憶體資源和範圍，讓 linker 能正確地將 object 映射到可使用的記憶體空間，因此 TinyGo 也內建不同 device 的 linkerscript 以供編譯時使用。一樣以 Pico 為例：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#57606a># targets/pico.ld
</span></span></span><span style=display:flex><span>MEMORY
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>/* Reserve exactly 256 bytes at start of flash for second stage bootloader */</span>
</span></span><span style=display:flex><span>    <span style=color:#6639ba>BOOT2_TEXT</span> <span style=color:#1f2328>(</span>rx<span style=color:#1f2328>)</span> <span style=color:#0550ae>:</span> ORIGIN <span style=color:#0550ae>=</span> <span style=color:#0550ae>0x10000000</span><span style=color:#1f2328>,</span> LENGTH <span style=color:#0550ae>=</span> <span style=color:#0550ae>256</span>
</span></span><span style=display:flex><span>    <span style=color:#6639ba>FLASH_TEXT</span> <span style=color:#1f2328>(</span>rx<span style=color:#1f2328>)</span> <span style=color:#0550ae>:</span> ORIGIN <span style=color:#0550ae>=</span> <span style=color:#0550ae>0x10000000</span> <span style=color:#0550ae>+</span> <span style=color:#0550ae>256</span><span style=color:#1f2328>,</span> LENGTH <span style=color:#0550ae>=</span> <span style=color:#0550ae>2048</span>K <span style=color:#0550ae>-</span> <span style=color:#0550ae>256</span>
</span></span><span style=display:flex><span>    <span style=color:#6639ba>RAM</span> <span style=color:#1f2328>(</span>rwx<span style=color:#1f2328>)</span>       <span style=color:#0550ae>:</span> ORIGIN <span style=color:#0550ae>=</span> <span style=color:#0550ae>0x20000000</span><span style=color:#1f2328>,</span> LENGTH <span style=color:#0550ae>=</span> <span style=color:#0550ae>256</span>k
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>INCLUDE <span style=color:#0a3069>&#34;targets/rp2040.ld&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>pico.ld</code> 將記憶體主要分成三部分：BOOT2、FLASH、RAM，其 memory layout 分配是基於 datasheet 和 Pico SDK 的 linkerscript，同樣地為了能重複利用 linkerscript，因此將部分共用的 script 拆分開來。例如 Pico 的 linkerscript 包含 rp2040.ld，而 rp2040.ld 則是包含 arm.ld。</p><blockquote><p>Note:
這樣的 linkerscript 雖然可以達到重複利用的目的，不過卻缺少一些客製化空間。例如 rp2040 本身為 dual core，不過 stack 空間卻是寫在 arm.ld，因此只有分配到一個 core 可以使用的 stack，不同於原生 Pico SDK 能為兩個 core 分配各自的 stack 空間。</p></blockquote><h3 id=multiple-devices>Multiple Devices</h3><p>除了不同 device 的 config file 差異之外，TinyGo 也透過 Go build tag 來實現不同 device 的硬體抽象層實作。在 json config file 的 <code>"build-tags": ["pico"]</code> 即可看出端倪。以最基本的 Pin 為例：</p><ul><li>根據 Pico datasheet 定義出具體的 Pin 腳。</li></ul><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#57606a>// +build pico</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>package</span><span style=color:#fff> </span><span style=color:#1f2328>machine</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>const</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#57606a>// GPIO pins</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>GPIO0</span><span style=color:#fff>  </span><span style=color:#1f2328>Pin</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#57606a>// ...more pins</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>抽象層，提供通用的操作 function。</li></ul><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>package</span><span style=color:#fff> </span><span style=color:#1f2328>machine</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>Pin</span><span style=color:#fff> </span><span style=color:#cf222e>uint8</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>p</span><span style=color:#fff> </span><span style=color:#1f2328>Pin</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>High</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>p</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Set</span><span style=color:#1f2328>(</span><span style=color:#cf222e>true</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>p</span><span style=color:#fff> </span><span style=color:#1f2328>Pin</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>Low</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>p</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Set</span><span style=color:#1f2328>(</span><span style=color:#cf222e>false</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>根據 RP2040 microcontroller datasheet 來實作硬體控制。</li></ul><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#57606a>// +build rp2040</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>package</span><span style=color:#fff> </span><span style=color:#1f2328>machine</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>p</span><span style=color:#fff> </span><span style=color:#1f2328>Pin</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>set</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>mask</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>uint32</span><span style=color:#1f2328>(</span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>p</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>rp</span><span style=color:#1f2328>.</span><span style=color:#1f2328>SIO</span><span style=color:#1f2328>.</span><span style=color:#1f2328>GPIO_OUT_SET</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Set</span><span style=color:#1f2328>(</span><span style=color:#1f2328>mask</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>p</span><span style=color:#fff> </span><span style=color:#1f2328>Pin</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>get</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#cf222e>bool</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#1f2328>rp</span><span style=color:#1f2328>.</span><span style=color:#1f2328>SIO</span><span style=color:#1f2328>.</span><span style=color:#1f2328>GPIO_IN</span><span style=color:#1f2328>.</span><span style=color:#6639ba>HasBits</span><span style=color:#1f2328>(</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>p</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>藉由這樣的介面設計，即可抽換硬體控制方式，讓程式可以被移植到其他 device 上。</p><h2 id=experiment>Experiment</h2><p>以下撰寫簡單的 Go 程式來示範如何結合 Go 語言和 TinyGo library 來實際操作硬體。</p><h3 id=需求>需求</h3><p>使用 interrupt handler，讓 user 透過觸碰 touch sensor 來開關 Pico 內建的 led 燈。</p><h3 id=實驗環境>實驗環境</h3><ul><li>Raspberry Pi 3 Model B (host)</li><li>Raspberry Pico</li><li>TTP223 Touch sensor</li></ul><p>我們在 Pi 3 主機撰寫和編譯程式，並且透過 Pico 的 Serial Wire Debug (SWD) port 將編譯好的執行檔放到 Pico 開發板上。詳細編譯和載入程式的流程可以參考 <a href=https://datasheets.raspberrypi.org/pico/getting-started-with-pico.pdf>Getting started with Raspberry Pi Pico</a>。</p><h4 id=compiler-version>Compiler Version</h4><ul><li>Go version go1.17.1 linux/arm</li><li>TinyGo version 0.20.0 linux/arm</li><li>LLVM version 11.0.0</li></ul><h4 id=gpio>GPIO</h4><ul><li>Pico 的 34(GPIO28)、36(3V3OUT)、38(GND) 分別連結 touch sensor 的 S(signal)、V(vcc)、G(GND)</li><li>根據 <a href=https://datasheets.raspberrypi.org/pico/getting-started-with-pico.pdf>Getting started with Raspberry Pi Pico: 5.2. SWD Port Wiring</a> 將 SWD pin 連結到 Pi 3 的 18、20、22 pin 腳。</li></ul><h3 id=實驗過程>實驗過程</h3><p>在實作 code 之前，先來分析一下需要哪些硬體控制行為。要讓 CPU 收到由 touch sensor 傳遞過來的 interrupt，並且由對應的 interrupt handler 處理，需要幾個前置條件：</p><ol><li>Enable GPIO28(與 touch sensor 的 signal pin 對接) 的 interrupt。</li><li>Enable NVIC(Nested Vectored Interrupt Controller) 指定的 interrupt source。</li><li>在 vector table 對應位置設置指定的 interrupt handler。</li></ol><h4 id=enable-gpio28-interrupt>Enable GPIO28 interrupt</h4><p>根據 RP2040 datasheet 2.19 GPIO 章節提及：</p><blockquote><p>RP2040 has 36 multi-functional General Purpose Input / Output (GPIO) pins, divided into two banks. In a typical use
case, the pins in the QSPI bank (QSPI_SS, QSPI_SCLK and QSPI_SD0 to QSPI_SD3) are used to execute code from an
external flash device, leaving the <strong>User bank (GPIO0 to GPIO29) for the programmer to use</strong>.</p></blockquote><p>可以知道 User Bank 提供控制 GPIO 功能。另外， 2.19.3 小節提到四種 GPIO interrupt scenario：<code>Level High</code>、<code>Level Low</code>、<code>Edge High</code>、<code>Edge Low</code>。結合 2.19.6.1. IO - User Bank 的 register table，即可設置 register 來針對指定的 GPIO 啟用不同的 interrupt scenario。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIO</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>status</span><span style=color:#fff> </span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>ctrl</span><span style=color:#fff>   </span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>interruptEnable</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>interruptForce</span><span style=color:#fff>  </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>interruptStatus</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#57606a>// the struct is based on 2.19.6.1. IO - User Bank registers</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIOBank0Type</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>io</span><span style=color:#fff>                 </span><span style=color:#1f2328>[</span><span style=color:#0550ae>30</span><span style=color:#1f2328>]</span><span style=color:#1f2328>PicoIO</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>intR</span><span style=color:#fff>               </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>proc0IRQctrl</span><span style=color:#fff>       </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>proc1IRQctrl</span><span style=color:#fff>       </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>dormantWakeIRQctrl</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff> </span><span style=color:#cf222e>uint8</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#57606a>// rp package provides pre-defined registers for rp2040</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>var</span><span style=color:#fff> </span><span style=color:#1f2328>ioBank0</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#1f2328>PicoIOBank0Type</span><span style=color:#1f2328>)(</span><span style=color:#1f2328>unsafe</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Pointer</span><span style=color:#1f2328>(</span><span style=color:#1f2328>rp</span><span style=color:#1f2328>.</span><span style=color:#1f2328>IO_BANK0</span><span style=color:#1f2328>))</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#57606a>// trigger an interrupt when logical change</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>var</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>Released</span><span style=color:#fff> </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>Touched</span><span style=color:#fff>  </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=enable-nvic-interrupt-source>Enable NVIC interrupt source</h4><p>GPIO 的 interrupt 被觸發後，會 route 到 Nested Vectored Interrupt Controller(NVIC) 以通知 CPU 有 interrupt event。因此我們也需要 enable NVIC 有關 GPIO 的 IRQ。同樣參考 datasheet 2.3.2. Interrupts，其中 IRQ 13: <code>IO_IRQ_BANK0</code> 就是我們要 enable 的 interrupt source。</p><h4 id=config-interrupt-handler>Config Interrupt Handler</h4><p>最後就是將我們的 interrupt handler address 設置在 vector table，當 CPU 接收到此 interrupt event 後，就會根據 vector table 來執行對應的 handler。</p><h3 id=implementation>Implementation</h3><p>相較於 C，使用 Go 操作硬體會較為複雜，主要是因為 Go 簡化了其語法，但是也代表 Go source code 在經過語意分析後的結果會複雜許多（舉例來說， Go function 其實會包含 context 和 function method 等部分，在設置 interrupt handler 時就需要額外的處理）。</p><p>幸好 TinyGo 提供了相關的 structure 和 package，例如 <code>volatile.Register32</code>、<code>interrupt</code> 等，以及針對各 deivce 提供最基本的 register address package（例如 <code>device/rp</code>），善用這些 package 就能夠正確地調整 register 值，讓硬體執行如預期的行為。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">98
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>package</span><span style=color:#fff> </span><span style=color:#1f2328>main</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#0a3069>&#34;device/rp&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#0a3069>&#34;runtime/volatile&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#0a3069>&#34;runtime/interrupt&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#0a3069>&#34;unsafe&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#0a3069>&#34;machine&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff> </span><span style=color:#cf222e>uint8</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>Touch</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>pin</span><span style=color:#fff>  </span><span style=color:#1f2328>machine</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Pin</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>intr</span><span style=color:#fff> </span><span style=color:#1f2328>interrupt</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Interrupt</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>action</span><span style=color:#fff> </span><span style=color:#cf222e>func</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>change</span><span style=color:#fff> </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIO</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>status</span><span style=color:#fff> </span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>ctrl</span><span style=color:#fff>   </span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>interruptEnable</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>interruptForce</span><span style=color:#fff>  </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>interruptStatus</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIOBank0Type</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>io</span><span style=color:#fff>                 </span><span style=color:#1f2328>[</span><span style=color:#0550ae>30</span><span style=color:#1f2328>]</span><span style=color:#1f2328>PicoIO</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>intR</span><span style=color:#fff>               </span><span style=color:#1f2328>[</span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>proc0IRQctrl</span><span style=color:#fff>       </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>proc1IRQctrl</span><span style=color:#fff>       </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>dormantWakeIRQctrl</span><span style=color:#fff> </span><span style=color:#1f2328>PicoIRQCtrl</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>var</span><span style=color:#fff> </span><span style=color:#1f2328>ioBank0</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#1f2328>PicoIOBank0Type</span><span style=color:#1f2328>)(</span><span style=color:#1f2328>unsafe</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Pointer</span><span style=color:#1f2328>(</span><span style=color:#1f2328>rp</span><span style=color:#1f2328>.</span><span style=color:#1f2328>IO_BANK0</span><span style=color:#1f2328>))</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>var</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>Released</span><span style=color:#fff> </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>Touched</span><span style=color:#fff>  </span><span style=color:#1f2328>TouchChange</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>var</span><span style=color:#fff> </span><span style=color:#1f2328>interTouch</span><span style=color:#fff> </span><span style=color:#1f2328>Touch</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>var</span><span style=color:#fff> </span><span style=color:#1f2328>led</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>machine</span><span style=color:#1f2328>.</span><span style=color:#1f2328>LED</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>Touch</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>irqEnableCtrl</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>volatile</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Register32</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>ioBank0</span><span style=color:#1f2328>.</span><span style=color:#1f2328>proc0IRQctrl</span><span style=color:#1f2328>.</span><span style=color:#1f2328>interruptEnable</span><span style=color:#1f2328>[</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>pin</span><span style=color:#fff> </span><span style=color:#0550ae>/</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>Touch</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>enableChangeEvent</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>target</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>pin</span><span style=color:#fff> </span><span style=color:#0550ae>%</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#6639ba>irqEnableCtrl</span><span style=color:#1f2328>().</span><span style=color:#6639ba>ClearBits</span><span style=color:#1f2328>(</span><span style=color:#0550ae>0xF</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>target</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#6639ba>irqEnableCtrl</span><span style=color:#1f2328>().</span><span style=color:#6639ba>SetBits</span><span style=color:#1f2328>(</span><span style=color:#6639ba>uint32</span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>change</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>target</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>Touch</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>acknowledgeChange</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>ioBank0</span><span style=color:#1f2328>.</span><span style=color:#1f2328>intR</span><span style=color:#1f2328>[</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>pin</span><span style=color:#fff> </span><span style=color:#0550ae>/</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>].</span><span style=color:#6639ba>SetBits</span><span style=color:#1f2328>(</span><span style=color:#6639ba>uint32</span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>change</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>((</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>pin</span><span style=color:#fff> </span><span style=color:#0550ae>%</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>))</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>Touch</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>handleInterrupt</span><span style=color:#1f2328>(</span><span style=color:#1f2328>interrupt</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Interrupt</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#6639ba>acknowledgeChange</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#6639ba>action</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>t</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>Touch</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#6639ba>Enable</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#cf222e>error</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#6639ba>enableChangeEvent</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>t</span><span style=color:#1f2328>.</span><span style=color:#1f2328>intr</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Enable</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#cf222e>nil</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#6639ba>NewTouch</span><span style=color:#1f2328>(</span><span style=color:#1f2328>pin</span><span style=color:#fff> </span><span style=color:#1f2328>machine</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Pin</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>change</span><span style=color:#fff> </span><span style=color:#1f2328>TouchChange</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>action</span><span style=color:#fff> </span><span style=color:#cf222e>func</span><span style=color:#1f2328>())</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>Touch</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>interTouch</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#1f2328>.</span><span style=color:#1f2328>pin</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>pin</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#1f2328>.</span><span style=color:#1f2328>action</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>action</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#1f2328>.</span><span style=color:#1f2328>change</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>change</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#1f2328>.</span><span style=color:#1f2328>intr</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>interrupt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>New</span><span style=color:#1f2328>(</span><span style=color:#1f2328>rp</span><span style=color:#1f2328>.</span><span style=color:#1f2328>IRQ_IO_IRQ_BANK0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>interTouch</span><span style=color:#1f2328>.</span><span style=color:#1f2328>handleInterrupt</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#1f2328>touch</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#6639ba>main</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>led</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Configure</span><span style=color:#1f2328>(</span><span style=color:#1f2328>machine</span><span style=color:#1f2328>.</span><span style=color:#1f2328>PinConfig</span><span style=color:#1f2328>{</span><span style=color:#1f2328>Mode</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>machine</span><span style=color:#1f2328>.</span><span style=color:#1f2328>PinOutput</span><span style=color:#1f2328>})</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touchAtion</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#cf222e>func</span><span style=color:#1f2328>(){</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>led</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Get</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#1f2328>led</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Low</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#1f2328>led</span><span style=color:#1f2328>.</span><span style=color:#6639ba>High</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>NewTouch</span><span style=color:#1f2328>(</span><span style=color:#1f2328>machine</span><span style=color:#1f2328>.</span><span style=color:#1f2328>GPIO28</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>Touched</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>touchAtion</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>touch</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Enable</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>select</span><span style=color:#1f2328>{}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=challenges>Challenges</h2><p>雖然 TinyGo 提供另一種撰寫 microcontroller 應用程式的可能性，不過實際測試之後，發現還是有很多挑戰需要去克服。</p><ol><li><p><strong>缺乏完整的 SDK 和 API</strong>：以 Pico 為例，原生的 pico-sdk 提供非常齊全的硬體控制 API，甚至還額外提供許多 wrapper function 讓 user 可以更方便地呼叫想要的功能。這部分 TinyGo 可能就必須仰賴大量 contributor 來將 device 既有的 SDK 移植。</p></li><li><p><strong>共用性和客制化的權衡</strong>：雖然 TinyGo 期望能支援多種不同的 device，因此將 device 硬體設定分層共用，不過也因此可能會造成部分共用設定其實不能很好地適應在特定 device 上。</p></li></ol><h2 id=conclusion>Conclusion</h2><p>TinyGo 結合原有 Go compiler 來延伸出適合 microcontroller 的 TinyGo compiler。雖然因為部分限制，不太可能實際應用在 production 上，但是拿來教學教育也是還不錯的選擇，希望之後在開發板可以和 microPython 一樣，能提供 Go 相關 library 供開發者使用。</p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2021-09-04-tsmc-sre-interview/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>台積電 SRE 面試心得</span>
</a><a href=https://yushuanhsieh.github.io/posts/2021-12-01-status-update/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>12/1 生日快樂</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>