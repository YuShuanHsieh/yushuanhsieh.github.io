<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A technical blog about software engineering, system design, and modern development practices."><meta name=author content="Cherie Hsieh"><title>Golang slice append 實作細節 — Cherie's Tech Blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href="/css/style.css?v=1771496292"></head><body><header class=site-header><div class=header-inner><a href=https://yushuanhsieh.github.io/ class=site-logo><span class=logo-icon>⟨/⟩</span>
<span class=logo-text>Cherie's Tech Blog</span></a><nav class=site-nav><a href=/ class=nav-link>Home</a>
<a href=/posts/ class=nav-link>Posts</a>
<a href=/categories/ class=nav-link>Categories</a>
<a href=/about/ class=nav-link>About</a></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span></span>
<span></span>
<span></span></button></div></header><main class=site-main><article class=single-post><header class=post-header><h1 class=post-title>Golang slice append 實作細節</h1><div class=post-meta><time datetime=2021-12-29>December 29, 2021</time>
<span class=separator>·</span>
<span class=reading-time>12 min read</span></div><div class=post-categories><a href=https://yushuanhsieh.github.io/categories/go/>Go</a></div></header><div class=post-content><p>用 Golang 刷 leetcode 題目時，如果不太清楚 Golang slice 與相關 function 的運作原理，很容易踩到坑，尤其是使用其他高階語言的開發者，剛轉換到 Golang 時會覺得為什麼同樣的程式邏輯，但是出來的結果卻不一樣。因此本篇簡單說明 Golang 最常使用到的 slice append function 運作原理，並且使用 objdump 來觀察記憶體操作狀況。</p><h2 id=slice-internal>Slice internal</h2><p>首先推薦先閱讀 Golang blog <a href=https://go.dev/blog/slices-intro>Go Slices: usage and internals</a>，雖然距離文章發布的日期已久遠，但是 slice internal 結構還是可以參考。文中很重要的一個概念是：<strong>A slice is a descriptor of an array segment.</strong>， 雖然我們使用 slice 方式很像 array ，但實際上 slice 是一個 descriptor struct ，其中會有一個 array pointer 指向真正存放數值的 array 中。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>type</span><span style=color:#fff> </span><span style=color:#1f2328>slice</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>array</span><span style=color:#fff> </span><span style=color:#1f2328>unsafe</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Pointer</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>len</span><span style=color:#fff>   </span><span style=color:#cf222e>int</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>cap</span><span style=color:#fff>   </span><span style=color:#cf222e>int</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>此時，如果我們要把一個既有的 slice assign 給新的 slice 變數：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>int</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#1f2328>nums</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>上述的 code 看起來好像是新建立了一個新的 slice <code>newNums</code>，不過剛剛有提到 slice 是 descriptor struct 型態，因此 <code>newNums</code> 其實是複製 <code>nums</code> struct member 的值，以致 <code>newNums</code> 和 <code>nums</code> 擁有相同的 length、capacity、array pointer，所以雖然是兩個 slice，但底層卻是<strong>共用同一個 array</strong> 記憶體區段。</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>fmt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Printf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%p \n&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span><span style=color:#fff> </span><span style=color:#57606a>// 0xc000018030 </span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>fmt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Printf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%p \n&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span><span style=color:#fff> </span><span style=color:#57606a>// 0xc000018030 </span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>而這個概念在 slice 指向的 array 空間不夠，需要擴充 array 空間時，情況就會不一樣了。在 <a href=https://go.dev/blog/slices-intro>Go Slices: usage and internals</a> 中有提到：</p><blockquote><p>To increase the capacity of a slice one must <strong>create a new</strong>, larger slice and copy the contents of the original slice into it.</p></blockquote><p>遇到這種情況，剛剛提及的 <code>nums</code> 和 <code>newNums</code> 變數，就會因為新 allocate 一塊較大的 array 記憶體區段的擴充流程，導致 <code>nums</code> 和 <code>newNums</code> 的 array pointer 不再是指向同一個 array 記憶體，而是會一個指向新的 array 記憶體、另一個指向舊的：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>int</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#57606a>// both of them share the same array pointer</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>fmt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Printf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%p \n&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span><span style=color:#fff> </span><span style=color:#57606a>// 0xc000018030 </span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>fmt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Printf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%p \n&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span><span style=color:#fff> </span><span style=color:#57606a>// 0xc000018030</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#57606a>// Growing slices, creating a new array area for newNums</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>fmt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Printf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%p \n&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span><span style=color:#fff> </span><span style=color:#57606a>// 0xc000018050</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>fmt</span><span style=color:#1f2328>.</span><span style=color:#6639ba>Printf</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;%p \n&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>])</span><span style=color:#fff> </span><span style=color:#57606a>// 0xc000018030</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>至於 array 擴充後的記憶體空間是怎麼計算的呢？我們可以從 <a href=https://github.com/golang/go/blob/master/src/runtime/slice.go#L166>Golang source code</a> 的 <code>runtime.growslice</code> 找到答案：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#6639ba>growslice</span><span style=color:#1f2328>(</span><span style=color:#1f2328>et</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#1f2328>_type</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>old</span><span style=color:#fff> </span><span style=color:#1f2328>slice</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>cap</span><span style=color:#fff> </span><span style=color:#cf222e>int</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>slice</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#1f2328>old</span><span style=color:#1f2328>.</span><span style=color:#1f2328>cap</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>doublecap</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#1f2328>newcap</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>cap</span><span style=color:#fff> </span><span style=color:#1f2328>&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>doublecap</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>cap</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#cf222e>const</span><span style=color:#fff> </span><span style=color:#1f2328>threshold</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#0550ae>256</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>old</span><span style=color:#1f2328>.</span><span style=color:#1f2328>cap</span><span style=color:#fff> </span><span style=color:#1f2328>&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>threshold</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>doublecap</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#57606a>// Check 0 &lt; newcap to detect overflow</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#57606a>// and prevent an infinite loop.</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#cf222e>for</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#fff> </span><span style=color:#1f2328>&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;&amp;</span><span style=color:#fff> </span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#1f2328>&lt;</span><span style=color:#fff> </span><span style=color:#1f2328>cap</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>				</span><span style=color:#57606a>// Transition from growing 2x for small slices</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>				</span><span style=color:#57606a>// to growing 1.25x for large slices. This formula</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>				</span><span style=color:#57606a>// gives a smooth-ish transition between the two.</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>				</span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#0550ae>+=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#0550ae>*</span><span style=color:#1f2328>threshold</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>/</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#57606a>// Set newcap to the requested cap when</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#57606a>// the newcap calculation overflowed.</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;=</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>				</span><span style=color:#1f2328>newcap</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>cap</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>			</span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>		</span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>在 capacity &lt; 256 情況下， capacity 擴充是用 <strong>2 倍</strong>的方式來增加，也就是 1 -> 2 -> 4 -> 8 -> 16 等，而當 capacity 超過 256 時，此時擴充所需要的記憶體空間相對較大，因此僅會以 <strong>1.25 倍</strong>的方式增加。</p><h2 id=slice-append-function>Slice append function</h2><p>有了上述的概念後，可以知道關鍵在於 slice 指向的 array 擴充時間點，其中最常見的應用場景就是我們使用 slice append function 在 slice 中加入新的數值，此時如果指向的 array 空間不足，就會觸發 <code>growslice</code> allocate 一個新的 array 空間。</p><p>而在 <a href=https://go.dev/blog/slices-intro>Go Slices: usage and internals</a> 有提及簡單的 append function 實作流程概念：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span><span style=color:#fff> </span><span style=color:#6639ba>AppendByte</span><span style=color:#1f2328>(</span><span style=color:#1f2328>slice</span><span style=color:#fff> </span><span style=color:#1f2328>[]</span><span style=color:#cf222e>byte</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>data</span><span style=color:#fff> </span><span style=color:#0550ae>...</span><span style=color:#cf222e>byte</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>[]</span><span style=color:#cf222e>byte</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>m</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>len</span><span style=color:#1f2328>(</span><span style=color:#1f2328>slice</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>n</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#1f2328>m</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#6639ba>len</span><span style=color:#1f2328>(</span><span style=color:#1f2328>data</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>n</span><span style=color:#fff> </span><span style=color:#1f2328>&gt;</span><span style=color:#fff> </span><span style=color:#6639ba>cap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>slice</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>newSlice</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>byte</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#1f2328>n</span><span style=color:#0550ae>+</span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#0550ae>*</span><span style=color:#0550ae>2</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6639ba>copy</span><span style=color:#1f2328>(</span><span style=color:#1f2328>newSlice</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>slice</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>slice</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>newSlice</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>slice</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>slice</span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>:</span><span style=color:#1f2328>n</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#6639ba>copy</span><span style=color:#1f2328>(</span><span style=color:#1f2328>slice</span><span style=color:#1f2328>[</span><span style=color:#1f2328>m</span><span style=color:#1f2328>:</span><span style=color:#1f2328>n</span><span style=color:#1f2328>],</span><span style=color:#fff> </span><span style=color:#1f2328>data</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#57606a>// append data to the existing array</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#1f2328>slice</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>除了 grow 流程之外，如果當前 array capacity 足夠的情況下，會將資料直接 append 到既有 array 空間中，並且將既有的 slice 回傳回去。</p><p>我們透過 objdump 出來的 machine code 來看 append function 具體的實作方式：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a245:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>73</span> <span style=color:#0550ae>01</span>                  	<span style=color:#0550ae>leaq</span>	<span style=color:#0550ae>1</span><span style=color:#1f2328>(</span><span style=color:#953800>%rbx</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rsi</span> <span style=color:#57606a># length value += 1
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a249:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>b</span> <span style=color:#0550ae>5</span><span style=color:#0550ae>c</span> <span style=color:#0550ae>24</span> <span style=color:#0550ae>40</span>               	<span style=color:#0550ae>movq</span>	<span style=color:#0550ae>64</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rbx</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a24e:</span> <span style=color:#6639ba>eb</span> <span style=color:#0550ae>00</span>                        	<span style=color:#0550ae>jmp</span>	<span style=color:#0550ae>0x108a250</span> <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>_main.main</span><span style=color:#1f2328>+</span><span style=color:#0550ae>0xb0</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a250:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>14</span> <span style=color:#0550ae>d8</span>                  	<span style=color:#0550ae>leaq</span>	<span style=color:#1f2328>(</span><span style=color:#953800>%rax</span><span style=color:#1f2328>,</span><span style=color:#953800>%rbx</span><span style=color:#1f2328>,</span><span style=color:#0550ae>8</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rdx</span> <span style=color:#57606a># %rax store the array pointer
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a254:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>52</span> <span style=color:#0550ae>08</span>                  	<span style=color:#0550ae>leaq</span>	<span style=color:#0550ae>8</span><span style=color:#1f2328>(</span><span style=color:#953800>%rdx</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rdx</span> <span style=color:#57606a># append 2 value to array
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a258:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#6639ba>c7</span> <span style=color:#0550ae>02</span> <span style=color:#0550ae>02</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span>         	<span style=color:#0550ae>movq</span>	<span style=color:#0550ae>$2</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>(</span><span style=color:#953800>%rdx</span><span style=color:#1f2328>)</span> <span style=color:#57606a># append 2 value to array
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a25f:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>44</span> <span style=color:#f6f8fa;background-color:#82071e>24</span> <span style=color:#f6f8fa;background-color:#82071e>68</span>               	<span style=color:#6639ba>movq</span>	<span style=color:#953800>%rax</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>104</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span> <span style=color:#57606a># update array pointer of slice descriptor
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a264:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>74</span> <span style=color:#f6f8fa;background-color:#82071e>24</span> <span style=color:#f6f8fa;background-color:#82071e>70</span>               	<span style=color:#6639ba>movq</span>	<span style=color:#953800>%rsi</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>112</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span> <span style=color:#57606a># update length value of slice descriptor
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a269:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>4</span><span style=color:#6639ba>c</span> <span style=color:#0550ae>24</span> <span style=color:#0550ae>78</span>               	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rcx</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>120</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span> <span style=color:#57606a># update capacity of slice descriptor
</span></span></span></code></pre></td></tr></table></div></div><p>如果有觸發 growslice 擴充 array 空間，則會在建立新的 array 後，將資料 append 到新 array 中，並且更新 slice descriptor 的 array pointer 、length、以及 capacity；反之，如果原有的 array 空間足夠，則會將資料 append 到原有的 array 中，並調整 length 的數值。</p><p>這次我們一樣建立 <code>nums</code> 和 <code>newNums</code> 兩個 slice，並且搭配 append function，來觀察其底層 array 的變化：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>int</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>6</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>其中，我們觀察 append number 5 和 6 之間的 machine code：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a343:</span> <span style=color:#f6f8fa;background-color:#82071e>49</span> <span style=color:#6639ba>c7</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>05</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span>         	<span style=color:#0550ae>movq</span>	<span style=color:#0550ae>$5</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>(</span><span style=color:#953800>%r8</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a34a:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>44</span> <span style=color:#f6f8fa;background-color:#82071e>24</span> <span style=color:#f6f8fa;background-color:#82071e>68</span>               	<span style=color:#6639ba>movq</span>	<span style=color:#953800>%rax</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>104</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span> <span style=color:#57606a># nums struct
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a34f:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>54</span> <span style=color:#f6f8fa;background-color:#82071e>24</span> <span style=color:#f6f8fa;background-color:#82071e>70</span>               	<span style=color:#6639ba>movq</span>	<span style=color:#953800>%rdx</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>112</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a354:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>4</span><span style=color:#6639ba>c</span> <span style=color:#0550ae>24</span> <span style=color:#0550ae>78</span>               	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rcx</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>120</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a359:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>72</span> <span style=color:#0550ae>01</span>                  	<span style=color:#0550ae>leaq</span>	<span style=color:#0550ae>1</span><span style=color:#1f2328>(</span><span style=color:#953800>%rdx</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rsi</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a35d:</span> <span style=color:#f6f8fa;background-color:#82071e>0</span><span style=color:#6639ba>f</span> <span style=color:#0550ae>1</span><span style=color:#0550ae>f</span> <span style=color:#0550ae>00</span>                     	<span style=color:#0550ae>nopl</span>	<span style=color:#1f2328>(</span><span style=color:#953800>%rax</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a360:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>39</span> <span style=color:#6639ba>f1</span>                     	<span style=color:#0550ae>cmpq</span>	<span style=color:#953800>%rsi</span><span style=color:#1f2328>,</span> <span style=color:#953800>%rcx</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a363:</span> <span style=color:#f6f8fa;background-color:#82071e>73</span> <span style=color:#f6f8fa;background-color:#82071e>02</span>                        	<span style=color:#6639ba>jae</span>	<span style=color:#0550ae>0x108a367</span> <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>_main.main</span><span style=color:#1f2328>+</span><span style=color:#0550ae>0x1c7</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a365:</span> <span style=color:#6639ba>eb</span> <span style=color:#0550ae>02</span>                        	<span style=color:#0550ae>jmp</span>	<span style=color:#0550ae>0x108a369</span> <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>_main.main</span><span style=color:#1f2328>+</span><span style=color:#0550ae>0x1c9</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a367:</span> <span style=color:#6639ba>eb</span> <span style=color:#0550ae>27</span>                        	<span style=color:#0550ae>jmp</span>	<span style=color:#0550ae>0x108a390</span> <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>_main.main</span><span style=color:#1f2328>+</span><span style=color:#0550ae>0x1f0</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a369:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>54</span> <span style=color:#f6f8fa;background-color:#82071e>24</span> <span style=color:#f6f8fa;background-color:#82071e>40</span>               	<span style=color:#6639ba>movq</span>	<span style=color:#953800>%rdx</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>64</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a36e:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#6639ba>c3</span>                     	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rax</span><span style=color:#1f2328>,</span> <span style=color:#953800>%rbx</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a371:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#6639ba>cf</span>                     	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rcx</span><span style=color:#1f2328>,</span> <span style=color:#953800>%rdi</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a374:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>05</span> <span style=color:#0550ae>85</span> <span style=color:#0550ae>73</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span>         	<span style=color:#0550ae>leaq</span>	<span style=color:#0550ae>29573</span><span style=color:#1f2328>(</span><span style=color:#953800>%rip</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rax</span> <span style=color:#57606a># setup args for growslice
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a37b:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#6639ba>d1</span>                     	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rdx</span><span style=color:#1f2328>,</span> <span style=color:#953800>%rcx</span> <span style=color:#57606a># setup args for growslice
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a37e:</span> <span style=color:#f6f8fa;background-color:#82071e>66</span> <span style=color:#f6f8fa;background-color:#82071e>90</span>                        	<span style=color:#6639ba>nop</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a380:</span> <span style=color:#6639ba>e8</span> <span style=color:#0550ae>fb</span> <span style=color:#0550ae>9</span><span style=color:#0550ae>f</span> <span style=color:#0550ae>fb</span> <span style=color:#0550ae>ff</span>               	<span style=color:#0550ae>callq</span>	<span style=color:#0550ae>0x1044380</span> <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>_runtime.growslice</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a385:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>73</span> <span style=color:#0550ae>01</span>                  	<span style=color:#0550ae>leaq</span>	<span style=color:#0550ae>1</span><span style=color:#1f2328>(</span><span style=color:#953800>%rbx</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rsi</span> <span style=color:#57606a># %rbx is the return value from growslice
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a389:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>b</span> <span style=color:#0550ae>54</span> <span style=color:#0550ae>24</span> <span style=color:#0550ae>40</span>               	<span style=color:#0550ae>movq</span>	<span style=color:#0550ae>64</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rdx</span> <span style=color:#57606a># retrive the length of slice
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a38e:</span> <span style=color:#6639ba>eb</span> <span style=color:#0550ae>00</span>                        	<span style=color:#0550ae>jmp</span>	<span style=color:#0550ae>0x108a390</span> <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>_main.main</span><span style=color:#1f2328>+</span><span style=color:#0550ae>0x1f0</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a390:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>d</span> <span style=color:#0550ae>14</span> <span style=color:#0550ae>d0</span>                  	<span style=color:#0550ae>leaq</span>	<span style=color:#1f2328>(</span><span style=color:#953800>%rax</span><span style=color:#1f2328>,</span><span style=color:#953800>%rdx</span><span style=color:#1f2328>,</span><span style=color:#0550ae>8</span><span style=color:#1f2328>),</span> <span style=color:#953800>%rdx</span> <span style=color:#57606a># append value to slice
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a394:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#6639ba>c7</span> <span style=color:#0550ae>02</span> <span style=color:#0550ae>06</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span>         	<span style=color:#0550ae>movq</span>	<span style=color:#0550ae>$6</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>(</span><span style=color:#953800>%rdx</span><span style=color:#1f2328>)</span> <span style=color:#57606a># append value to slice
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a39b:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>84</span> <span style=color:#f6f8fa;background-color:#82071e>24</span> <span style=color:#f6f8fa;background-color:#82071e>80</span> <span style=color:#f6f8fa;background-color:#82071e>00</span> <span style=color:#f6f8fa;background-color:#82071e>00</span> <span style=color:#f6f8fa;background-color:#82071e>00</span>      	<span style=color:#6639ba>movq</span>	<span style=color:#953800>%rax</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>128</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span> <span style=color:#57606a># newNums
</span></span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a3a3:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#6639ba>b4</span> <span style=color:#0550ae>24</span> <span style=color:#0550ae>88</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span>      	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rsi</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>136</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#f6f8fa;background-color:#82071e>108</span><span style=color:#900;font-weight:700>a3ab:</span> <span style=color:#f6f8fa;background-color:#82071e>48</span> <span style=color:#f6f8fa;background-color:#82071e>89</span> <span style=color:#f6f8fa;background-color:#82071e>8</span><span style=color:#6639ba>c</span> <span style=color:#0550ae>24</span> <span style=color:#0550ae>90</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span> <span style=color:#0550ae>00</span>      	<span style=color:#0550ae>movq</span>	<span style=color:#953800>%rcx</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>144</span><span style=color:#1f2328>(</span><span style=color:#953800>%rsp</span><span style=color:#1f2328>)</span>
</span></span></code></pre></td></tr></table></div></div><p>nums 和 newNums 是兩個 slice 變數，可以看到其表示的地址也有所不同，因此在 <code>newNums = append(newNums, 7)</code> 僅會更新 newNums 的 pointer、length、與 capacity。但是，<strong>即使他們的 length 和 capacity 的數值是各自儲存，卻有可能是共用同一個 array，這也會造成如果誤用 slice asign 和 append function，將有可能會覆蓋掉既有 array 中的資料，進而造成後續結果不如預期</strong>。</p><p>舉一個簡單的例子：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>int</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>6</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums2</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>如果不清楚 Golang append function 的實作方式，有可能會誤以為上述的 code 其結果會是：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#fff> </span><span style=color:#0550ae>6</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums2</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#fff> </span><span style=color:#0550ae>6</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>但實際上出來的結果會是：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums2</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#fff> </span><span style=color:#0550ae>8</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>其結果不如預期的原因在於 <code>nums</code>、<code>newNums</code>、<code>newNums2</code> 三個 slice 變數的 array pointer 都指向同一個 array，這也導致在執行 <code>nums = append(nums, 7)</code> 時，會將上一步 <code>newNums := append(nums, 6)</code> append 到 array 的 6 給覆蓋掉成 7，最終造成 6 資料消失的情況。</p><p>而要避免這樣的錯誤發生，就是要確保不同的 slice 擁有不同的 array pointer，可以透過新建立一個 newNums slice (因為其 pointer 指向的 array 地址也會不同)，並且將 <code>nums</code> slice 的資料複製到 <code>newNums</code> slice，再進行 append：</p><div class=highlight><div style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>int</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#0550ae>:=</span><span style=color:#fff> </span><span style=color:#6639ba>make</span><span style=color:#1f2328>([]</span><span style=color:#cf222e>int</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#6639ba>len</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>),</span><span style=color:#fff> </span><span style=color:#6639ba>len</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>)</span><span style=color:#0550ae>+</span><span style=color:#0550ae>1</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#6639ba>copy</span><span style=color:#1f2328>(</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#1f2328>nums</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>newNums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>newNums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>6</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>nums</span><span style=color:#fff> </span><span style=color:#1f2328>=</span><span style=color:#fff> </span><span style=color:#6639ba>append</span><span style=color:#1f2328>(</span><span style=color:#1f2328>nums</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>7</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>由於 <code>nums</code> 和 <code>newNums</code> 擁有獨立的 array 空間，所以會得出我們預期的結果。</p><p>Happy New Year!</p></div><footer class=post-footer><div class=post-nav><a href=https://yushuanhsieh.github.io/posts/2021-12-10-lcd-2004/ class="post-nav-link prev"><span class=label>← Previous</span>
<span class=title>LCD 2004 module with Rasp Pico</span>
</a><a href=https://yushuanhsieh.github.io/posts/2022-01-01-review-2021/ class="post-nav-link next"><span class=label>Next →</span>
<span class=title>2021 年度回顧</span></a></div></footer></article></main><footer class=site-footer><div class=footer-inner><p class=footer-copyright>&copy; 2026 Cherie's Tech Blog. All rights reserved.</p><p class=footer-powered>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></p></div></footer></body></html>